{
  "cells": [
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "---\n",
        "title: \"5ì¡° Ames Project\"\n",
        "format:\n",
        "    dashboard:\n",
        "        logo: logo.png\n",
        "        # css: styles.css\n",
        "        page-layout: dashboard\n",
        "---\n",
        "\n",
        "\n",
        "\n",
        "# ëª©ì \n",
        "\n",
        "## Row\n",
        "\n",
        "### {.tabset}\n",
        "\n",
        "\n",
        "#### ğŸ’¡ ë¯¸êµ­ ì§‘ ë§¤ë§¤ ì˜ˆì‚°ì•ˆ\n",
        "\n",
        "- ë¯¸êµ­ Amesì— ì§‘ ë§¤ë§¤ ì˜ˆì‚°ì•ˆ êµ¬ì„±\n",
        "    - ì£¼íƒ ê°€ê²© <br>\n",
        "    - í´ë¡œì§• ë¹„ìš© : ë°”ì´ì–´ì™€ ì…€ëŸ¬ê°€ ì§€ë¶ˆí•˜ëŠ” ë¹„ìš© <br>\n",
        "    - ìœ ì§€ ë° ê´€ë¦¬ ë¹„ìš© : êµ¬ë§¤í•œ í›„ì— ë“¤ì–´ê°€ëŠ” ìœ ì§€ ë° ê´€ë¦¬ ë¹„ìš© <br>\n",
        "\n",
        "\n",
        "#### ğŸ’¡ ë¯¸êµ­ì˜ ì§‘ê°’ì€\n",
        "\n",
        "![](./homerepair.PNG){width=500px}\n",
        "<br>\n",
        "<br>\n",
        "- **ë¯¸êµ­ ì—°ê°„ ìœ ì§€ë¹„ìš©**ì— ëŒ€í•œ ê¶Œì¥ì‚¬í•­ì€ ì£¼íƒ ì›ë˜ ê°€ê²©ì˜ 1.5% ~ 4%ê¹Œì§€ ë‹¤ì–‘í•¨.<br>\n",
        "ex) 70ë§Œ ë‹¬ëŸ¬ì— ì£¼íƒì„ êµ¬ë§¤í•œë‹¤ë©´ ì—°ê°„ 10,500~28,000 ë‹¬ëŸ¬ë¥¼ ìœ ì§€ë¹„ë¡œ ì§€ì¶œ<br>\n",
        "\n",
        "\n",
        "#### ğŸ’¡ ëª©ì \n",
        "\n",
        "ğŸ“ ìœ ì§€ ë° ê´€ë¦¬ ë¹„ìš© â¬‡  ë§¤ë§¤ ê°€ê²© â¬‡ ì§‘ì„ ì°¾ì•„ë³´ì!\n",
        "<br>\n",
        "<br>\n",
        "ğŸ‘€ \" ì €ë ´í•œ ì§‘ê°’ë§Œ ë³´ê³  ìƒ€ë‹¤ê°€ ìœ ì§€ë¹„ í­íƒ„?\"\n",
        "<br>\n",
        "<br>\n",
        "í”„ë¡œì íŠ¸ ëª©ì  : ì§€ê¸ˆ ë‹¹ì¥ ë“œëŸ¬ë‚˜ëŠ” ê°€ê²©ë¿ ì•„ë‹ˆë¼, ì¥ê¸°ì ì¸ ìœ ì§€ ë¹„ìš©ê¹Œì§€ ê³ ë ¤í•œ â€˜ì§„ì§œ í•©ë¦¬ì ì¸ ì§‘ êµ¬ë§¤â€™ë¥¼ ê¿ˆê¾¸ëŠ” ì‚¬ëŒë“¤ì„ ìœ„í•œ Ames ë¶€ë™ì‚° ë¶„ì„ í”„ë¡œì íŠ¸\n",
        "\n",
        "\n",
        "\n",
        "    \n",
        "## Row \n"
      ],
      "id": "4f930663"
    },
    {
      "cell_type": "code",
      "metadata": {
        "content": "valuebox",
        "title": "í’ˆì§ˆ / ìƒíƒœ",
        "icon": "wrench",
        "color": "primary"
      },
      "source": [
        "dict(\n",
        "    value = (14)\n",
        ")"
      ],
      "id": "d1f291b3",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "code",
      "metadata": {
        "content": "valuebox",
        "title": "ë©´ì ",
        "color": "primary"
      },
      "source": [
        "dict(\n",
        "icon = \"aspect-ratio\",\n",
        "\n",
        "value = (5))"
      ],
      "id": "7596356a",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "code",
      "metadata": {
        "content": "valuebox",
        "title": "ìš•ì‹¤",
        "color": "primary"
      },
      "source": [
        "dict(\n",
        "icon = \"droplet\",\n",
        "\n",
        "value = 4)"
      ],
      "id": "5456412c",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "code",
      "metadata": {
        "content": "valuebox",
        "title": "ì—°ë„",
        "color": "primary"
      },
      "source": [
        "dict(\n",
        "icon = \"calendar\",\n",
        "\n",
        "value = 3)"
      ],
      "id": "27ad6dd5",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "## Row\n",
        "\n",
        "\n",
        "### í’ˆì§ˆ / ìƒíƒœ\n",
        "- `OverallQual`  \n",
        "- `OverallCond`  \n",
        "- `RoofStyle`  \n",
        "- `ExterQual`  \n",
        "- `ExterCond`  \n",
        "- `Exterior1st`  \n",
        "- `HeatingQC`  \n",
        "- `GarageCond`  \n",
        "- `BsmtCond`  \n",
        "- `BsmtQual`  \n",
        "- `KitchenQual`  \n",
        "- `GarageQual`  \n",
        "- `Foundation`  \n",
        "- `PavedDrive`\n",
        "\n",
        "\n",
        "### ë©´ì  ê´€ë ¨\n",
        "- `GrLivArea`  \n",
        "- `TotalBsmtSF`  \n",
        "- `GarageArea`  \n",
        "- `WoodDeckSF`  \n",
        "- `TotRmsAbvGrd`\n",
        "\n",
        "### ìš•ì‹¤ ê´€ë ¨\n",
        "- `FullBath`  \n",
        "- `HalfBath`  \n",
        "- `BsmtFullBath`  \n",
        "- `BsmtHalfBath`\n",
        "\n",
        "### ì—°ë„ ê´€ë ¨\n",
        "- `YearBuilt`  \n",
        "- `YearRemodAdd`  \n",
        "- `GarageYrBlt`\n"
      ],
      "id": "156bfbd0"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "#| echo: true\n",
        "#| include: false\n",
        "\n",
        "import pandas as pd\n",
        "import numpy as np\n",
        "import matplotlib.pyplot as plt\n",
        "\n",
        "df = pd.read_csv(\"./plotly_data/ames.csv\")\n",
        "\n",
        "# ì‚¬ìš©ìê°€ ì œì‹œí•œ ë³€ìˆ˜ ëª©ë¡ ì •ë¦¬\n",
        "target_columns = [\n",
        "    # í’ˆì§ˆ/ìƒíƒœ ê´€ë ¨\n",
        "    'OverallQual', 'OverallCond', 'RoofStyle', 'ExterQual', 'ExterCond',\n",
        "    'Exterior1st', 'HeatingQC', 'GarageCond', 'BsmtCond', 'BsmtQual',\n",
        "    'KitchenQual', 'GarageQual', 'Foundation', 'PavedDrive',\n",
        "    \n",
        "    # ì—°ë„ ê´€ë ¨\n",
        "    'YearBuilt', 'YearRemodAdd', 'GarageYrBlt',\n",
        "    \n",
        "    # ìš•ì‹¤ ê´€ë ¨\n",
        "    'FullBath', 'HalfBath', 'BsmtFullBath', 'BsmtHalfBath',\n",
        "    \n",
        "    # ë©´ì  ê´€ë ¨\n",
        "    'GrLivArea', 'TotalBsmtSF', 'GarageArea', 'WoodDeckSF',\n",
        "    \n",
        "    # ìœ„ì¹˜ ê´€ë ¨\n",
        "    'TotRmsAbvGrd', 'Latitude', 'Longitude', 'SalePrice'\n",
        "]\n",
        "\n",
        "# ê²°ì¸¡ì¹˜ ê°œìˆ˜ í™•ì¸\n",
        "missing_info = df[target_columns].isnull().sum()\n",
        "missing_info = missing_info[missing_info > 0]\n",
        "missing_info\n",
        "df = df.dropna(subset=['Latitude', 'Longitude'])\n",
        "\n",
        "\n",
        "\n",
        "# 4. ê²°ì¸¡ì¹˜ ì²˜ë¦¬ \n",
        "# 4-1. ì¹´í…Œê³ ë¦¬í˜• ê²°ì¸¡ì¹˜: ì§€í•˜ì‹¤/ì°¨ê³ ê°€ ì—†ëŠ” ê²½ìš° \"None\" ì²˜ë¦¬\n",
        "df['GarageCond'] = df['GarageCond'].fillna(\"None\")\n",
        "df['BsmtCond'] = df['BsmtCond'].fillna(\"None\")\n",
        "df['BsmtQual'] = df['BsmtQual'].fillna(\"None\")\n",
        "df['GarageQual'] = df['BsmtQual'].fillna(\"None\")\n",
        "\n",
        "# 4-2. ìˆ˜ì¹˜í˜• ê²°ì¸¡ì¹˜: ì°¨ê³  ê±´ì¶•ì—°ë„ â†’ ì°¨ê³  ì—†ìŒì´ë©´ 0ìœ¼ë¡œ\n",
        "df['GarageYrBlt'] = df['GarageYrBlt'].fillna(0)\n",
        "\n",
        "df['BsmtFullBath'] = df['BsmtFullBath'].fillna(0)\n",
        "df['BsmtHalfBath'] = df['BsmtHalfBath'].fillna(0)\n",
        "df['TotalBsmtSF'] = df['TotalBsmtSF'].fillna(0)\n",
        "df['GarageArea'] = df['GarageArea'].fillna(0)\n",
        "df = df.drop(columns=['PID'])\n",
        "\n",
        "\n",
        "df = df[target_columns]\n",
        "\n",
        "# 5. ë²”ì£¼í˜• ë³€ìˆ˜ ì²˜ë¦¬í•˜ê¸°\n",
        "# 5ï¸-1. ë²”ì£¼í˜• ë³€ìˆ˜ â†’ ìˆ˜ì¹˜í˜• ë³€í™˜ (Ordinal Encoding)\n",
        "# ë²”ì£¼í˜• ë³€ìˆ˜ ìˆ˜ì¹˜í™” (Ordinal Encoding)\n",
        "ordinal_mappings = {\n",
        "    'ExterQual': {'None': 0, 'Po': 1, 'Fa': 2, 'TA': 3, 'Gd': 4, 'Ex': 5},\n",
        "    'ExterCond': {'None': 0, 'Po': 1, 'Fa': 2, 'TA': 3, 'Gd': 4, 'Ex': 5},\n",
        "    'HeatingQC': {'None': 0, 'Po': 1, 'Fa': 2, 'TA': 3, 'Gd': 4, 'Ex': 5},\n",
        "    'GarageCond': {'None': 0, 'Po': 1, 'Fa': 2, 'TA': 3, 'Gd': 4, 'Ex': 5},\n",
        "    'BsmtCond': {'None': 0, 'Po': 1, 'Fa': 2, 'TA': 3, 'Gd': 4, 'Ex': 5},\n",
        "    'BsmtQual': {'None': 0, 'Po': 1, 'Fa': 2, 'TA': 3, 'Gd': 4, 'Ex': 5},\n",
        "    'KitchenQual': {'None': 0, 'Po': 1, 'Fa': 2, 'TA': 3, 'Gd': 4, 'Ex': 5},\n",
        "    'GarageQual': {'None': 0, 'Po': 1, 'Fa': 2, 'TA': 3, 'Gd': 4, 'Ex': 5},\n",
        "}\n",
        "\n",
        "# ë§¤í•‘ ì ìš©\n",
        "for col, mapping in ordinal_mappings.items():\n",
        "    df[col] = df[col].map(mapping)\n",
        "\n",
        "df = pd.get_dummies(df, columns=['RoofStyle', 'Exterior1st', 'Foundation', 'PavedDrive'], drop_first=True)\n",
        "\n",
        "\n",
        "# 6ï¸. ê²°ì¸¡ì¹˜ í™•ì¸\n",
        "print(df.isnull().sum())\n",
        "\n",
        "\n",
        "# LassoCV (ë³€ìˆ˜ 39ê°œ)\n",
        "import pandas as pd\n",
        "from sklearn.linear_model import LassoCV\n",
        "from sklearn.preprocessing import StandardScaler\n",
        "\n",
        "# ë…ë¦½ë³€ìˆ˜(X), ì¢…ì†ë³€ìˆ˜(y) ë¶„ë¦¬\n",
        "X = df.drop(columns=['SalePrice'])\n",
        "y = df['SalePrice']\n",
        "\n",
        "# 1. ìŠ¤ì¼€ì¼ë§ (í‘œì¤€í™”)\n",
        "scaler = StandardScaler()\n",
        "X_scaled = scaler.fit_transform(X)  # Xë¥¼ í‰ê·  0, í‘œì¤€í¸ì°¨ 1ë¡œ ë³€í™˜\n",
        "\n",
        "# 2ï¸. LassoCV í•™ìŠµ (êµì°¨ê²€ì¦ìœ¼ë¡œ alpha ì°¾ê¸°)\n",
        "lasso = LassoCV(cv=5, random_state=2025)\n",
        "lasso.fit(X_scaled, y)\n",
        "\n",
        "# 3. ê²°ê³¼ í™•ì¸\n",
        "best_alpha = lasso.alpha_\n",
        "coefficients = lasso.coef_\n",
        "\n",
        "# 4. ê³„ìˆ˜ì™€ ë³€ìˆ˜ëª…ì„ ë°ì´í„°í”„ë ˆì„ìœ¼ë¡œ ì •ë¦¬\n",
        "coef_df = pd.DataFrame({\n",
        "    'Feature': X.columns,\n",
        "    'Coefficient': coefficients\n",
        "}).sort_values(by='Coefficient', key=abs, ascending=False)\n",
        "\n",
        "print(f\"Best alpha: {best_alpha}\")\n",
        "print(coef_df)\n",
        "\n",
        "\n",
        "X.columns"
      ],
      "id": "0c8f31c8",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "# ë³€ìˆ˜ ì„ íƒ\n",
        "\n",
        "### {.tabset}\n",
        "\n",
        "#### EDA ë°ì´í„° \n",
        "\n",
        "::: {.columns}\n",
        "\n",
        "::: {.column width=\"50%\"}\n"
      ],
      "id": "517fbdc3"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "#| echo: False\n",
        "#| include: true\n",
        "\n",
        "\n",
        "features = X.columns.tolist()\n",
        "\n",
        "# í‰ê·  SalePrice by YearBuilt ê·¸ë˜í”„\n",
        "ax = df.groupby(\"YearBuilt\")[\"SalePrice\"].mean().plot(\n",
        "    kind=\"line\", figsize=(10, 4), marker=\"o\", color=\"royalblue\"\n",
        ")\n",
        "\n",
        "ax.set_title(\"Average Sale Price by Year Built\")\n",
        "ax.set_xlabel(\"Year Built\")\n",
        "ax.set_ylabel(\"Average Sale Price\")\n",
        "ax.grid(True)\n",
        "plt.tight_layout()\n",
        "plt.show()"
      ],
      "id": "6de6e68d",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        ":::\n",
        "\n",
        "::: {.column width=\"50%\"}\n"
      ],
      "id": "a5cf5d34"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "#| echo: False\n",
        "#| include: true\n",
        "#### EDA   ì—°ì‹ê³¼ ê°€ê²©ì„ í†µí•œ ì§€ë„ ì‹œê°í™” 2\n",
        "\n",
        "import plotly.express as px\n",
        "\n",
        "fig = px.scatter_mapbox(\n",
        "    df,\n",
        "    lat=\"Latitude\",\n",
        "    lon=\"Longitude\",\n",
        "    color=\"YearBuilt\",           # ìƒ‰ìƒìœ¼ë¡œ ì—°ì‹ í‘œí˜„\n",
        "    size=\"SalePrice\",            # í¬ê¸°ë¡œ ê°€ê²© í‘œí˜„\n",
        "    color_continuous_scale=\"Blues\",\n",
        "    size_max=15,\n",
        "    zoom=11,\n",
        "    mapbox_style=\"carto-positron\",\n",
        "    hover_data=[\"SalePrice\", \"YearBuilt\", \"GrLivArea\", \"OverallQual\"]\n",
        ")\n",
        "\n",
        "fig.update_layout(\n",
        "    title=\"Housing Age & Price on Map\",\n",
        "    width=950,\n",
        "    height=600,\n",
        "    margin={\"r\":0,\"t\":40,\"l\":0,\"b\":0}\n",
        ")\n",
        "\n",
        "fig.show()\n"
      ],
      "id": "9dfa67f2",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        ":::\n",
        "\n",
        ":::\n",
        "\n",
        "#### ë°ì´í„° ì „ì²˜ë¦¬ ë° ê²°ì¸¡ì¹˜ ì²˜ë¦¬\n",
        "\n",
        "\n",
        "::: {.columns}\n",
        "\n",
        "::: {.column width=\"50%\"}\n",
        "\n",
        "\n",
        "- ì§€í•˜ì‹¤ ë° ì°¨ê³ ê°€ ì—†ëŠ” ê²½ìš°ëŠ” `'None'`ìœ¼ë¡œ ì±„ìš´ í›„, Ordinal Encodingì„ í†µí•´ ìˆ˜ì¹˜í™”í•¨.\n",
        "- ì°¨ê³  ê±´ì¶• ì—°ë„(GarageYrBlt), ì§€í•˜ì‹¤ ìš•ì‹¤ ë“± ì¼ë¶€ ìˆ˜ì¹˜í˜• ê²°ì¸¡ì¹˜ëŠ” `0`ìœ¼ë¡œ ì²˜ë¦¬í•¨.\n",
        "- ìµœì¢…ì ìœ¼ë¡œ 37ê°œ ì£¼ìš” ë³€ìˆ˜ ì¶”ì¶œí•¨.\n",
        "\n",
        "- ê°ì„±ì  íŠ¹ì„±ê³¼ ê´€ê³„ëœ 30ì—¬ ê°œ ë³€ìˆ˜ ì„ ì •  \n",
        "- í’ˆì§ˆ/ìƒíƒœ, ë©´ì , ìœ„ì¹˜, ì—°ë„, ìš•ì‹¤ ìˆ˜ ë“± í¬í•¨  \n",
        "- ì¢…ì†ë³€ìˆ˜ëŠ” `SalePrice` ì‚¬ìš©\n",
        "- `GarageCond`, `BsmtCond`, `BsmtQual`, `GarageQual` ë“±  \n",
        "  â†’ ê²°ì¸¡ = í•´ë‹¹ í•­ëª© ì—†ìŒ â†’ `\"None\"`ìœ¼ë¡œ ì²˜ë¦¬\n",
        "- `GarageYrBlt`, `BsmtFullBath`, `BsmtHalfBath`, `TotalBsmtSF`, `GarageArea`  \n",
        "  â†’ ê²°ì¸¡ = êµ¬ì¡°ë¬¼ ì—†ìŒ â†’ `0`ìœ¼ë¡œ ëŒ€ì²´\n",
        "\n",
        "- 1. ë²”ì£¼í˜• ë³€ìˆ˜ ìˆ˜ì¹˜í™”\n",
        "- Ordinal Encoding\n",
        "- í’ˆì§ˆ/ìƒíƒœ ê´€ë ¨: `\"None\"=0`, `\"Po\"=1` ~ `\"Ex\"=5`  \n",
        "- ëŒ€ìƒ ë³€ìˆ˜: `ExterQual`, `HeatingQC`, `KitchenQual`, ë“±\n",
        "- `RoofStyle`, `Exterior1st`, `Foundation`, `PavedDrive`  \n",
        "  â†’ `pd.get_dummies`ë¡œ ì²˜ë¦¬ (ê¸°ì¤€ê°’ ì œì™¸)\n",
        "\n",
        ":::\n",
        "\n",
        "::: {.column width=\"50%\"}\n"
      ],
      "id": "341cc238"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "from sklearn.linear_model import Lasso\n",
        "from sklearn.metrics import mean_squared_error\n",
        "import matplotlib.pyplot as plt\n",
        "import matplotlib.pyplot as plt\n",
        "import pandas as pd\n",
        "\n",
        "# ê³„ìˆ˜ê°€ 0ì´ ì•„ë‹Œ ë³€ìˆ˜ë§Œ ì„ íƒ\n",
        "selected_coef_df = coef_df[coef_df['Coefficient'] != 0].copy()\n",
        "\n",
        "# ì ˆëŒ€ê°’ ê¸°ì¤€ ì •ë ¬\n",
        "selected_coef_df = selected_coef_df.sort_values(by='Coefficient', key=abs, ascending=True)\n",
        "\n",
        "# ì‹œê°í™”\n",
        "plt.figure(figsize=(12, 10))\n",
        "plt.barh(selected_coef_df['Feature'], selected_coef_df['Coefficient'])\n",
        "plt.xlabel('Coefficient Value')\n",
        "plt.title('LassoCV - Selected Feature Coefficients')\n",
        "plt.grid(True)\n",
        "plt.tight_layout()\n",
        "plt.show()\n"
      ],
      "id": "9e1fb923",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        ":::\n",
        "\n",
        ":::\n",
        "\n",
        "\n",
        "\n",
        "\n",
        "#### ë³€ìˆ˜ ì„ ì • ë°©ë²•\n",
        "-   1. **LassoCV ê¸°ë°˜ ë³€ìˆ˜ ì„ íƒ**\n",
        "    - ë‹¤ì¤‘ê³µì„ ì„±ì„ ê³ ë ¤í•˜ì—¬ **LassoCV (5-Fold Cross Validation)** ë¥¼ ì ìš©.\n",
        "    - ìµœì ì˜ alpha(209)ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë³€ìˆ˜ ì¶•ì†Œ.\n",
        "<br>\n",
        "<br>\n",
        "\n",
        "-   2. **ìƒê´€ê³„ìˆ˜ ì ˆëŒ€ê°’ ê¸°ë°˜ ë³€ìˆ˜ ì„ íƒ**\n",
        "    - ì ˆëŒ€ê°’ì„ ê¸°ì¤€ìœ¼ë¡œ ìƒìœ„ 10ê°œì¸ ìƒê´€ê³„ìˆ˜ ë³€ìˆ˜ ì„ íƒ.\n"
      ],
      "id": "ef19a723"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "#| echo: true\n",
        "#| include: false\n",
        "import pandas as pd\n",
        "import numpy as np\n",
        "import matplotlib.pyplot as plt\n",
        "from mpl_toolkits.mplot3d import Axes3D\n",
        "import statsmodels.formula.api as smf\n",
        "import seaborn as sns\n",
        "from statsmodels.api import OLS\n",
        "from statsmodels.formula.api import ols\n",
        "import statsmodels.api as sm\n",
        "\n",
        "\n",
        "\n",
        "\n",
        "df = pd.read_csv(\"./plotly_data/ames.csv\")\n",
        "# ì‚¬ìš©ìê°€ ì œì‹œí•œ ë³€ìˆ˜ ëª©ë¡ ì •ë¦¬\n",
        "target_columns = [\n",
        "    # í’ˆì§ˆ/ìƒíƒœ ê´€ë ¨\n",
        "    'OverallQual', 'OverallCond', 'RoofStyle', 'ExterQual', 'ExterCond',\n",
        "    'Exterior1st', 'HeatingQC', 'GarageCond', 'BsmtCond', 'BsmtQual',\n",
        "    'KitchenQual', 'GarageQual', 'Foundation', 'PavedDrive',\n",
        "    \n",
        "    # ì—°ë„ ê´€ë ¨\n",
        "    'YearBuilt', 'YearRemodAdd', 'GarageYrBlt',\n",
        "    \n",
        "    # ìš•ì‹¤ ê´€ë ¨\n",
        "    'FullBath', 'HalfBath', 'BsmtFullBath', 'BsmtHalfBath',\n",
        "    \n",
        "    # ë©´ì  ê´€ë ¨\n",
        "    'GrLivArea', 'TotalBsmtSF', 'GarageArea', 'WoodDeckSF',\n",
        "    \n",
        "    # ìœ„ì¹˜ ê´€ë ¨\n",
        "    'TotRmsAbvGrd', 'Latitude', 'Longitude', 'SalePrice'\n",
        "]\n",
        "\n",
        "# ê²°ì¸¡ì¹˜ ê°œìˆ˜ í™•ì¸\n",
        "missing_info = df[target_columns].isnull().sum()\n",
        "missing_info = missing_info[missing_info > 0]\n",
        "missing_info\n",
        "df = df.dropna(subset=['Latitude', 'Longitude'])\n",
        "\n",
        "\n",
        "\n",
        "# 4. ê²°ì¸¡ì¹˜ ì²˜ë¦¬ \n",
        "# 4-1. ì¹´í…Œê³ ë¦¬í˜• ê²°ì¸¡ì¹˜: ì§€í•˜ì‹¤/ì°¨ê³ ê°€ ì—†ëŠ” ê²½ìš° \"None\" ì²˜ë¦¬\n",
        "df['GarageCond'] = df['GarageCond'].fillna(\"None\")\n",
        "df['BsmtCond'] = df['BsmtCond'].fillna(\"None\")\n",
        "df['BsmtQual'] = df['BsmtQual'].fillna(\"None\")\n",
        "df['GarageQual'] = df['BsmtQual'].fillna(\"None\")\n",
        "\n",
        "# 4-2. ìˆ˜ì¹˜í˜• ê²°ì¸¡ì¹˜: ì°¨ê³  ê±´ì¶•ì—°ë„ â†’ ì°¨ê³  ì—†ìŒì´ë©´ 0ìœ¼ë¡œ\n",
        "df['GarageYrBlt'] = df['GarageYrBlt'].fillna(0)\n",
        "\n",
        "df['BsmtFullBath'] = df['BsmtFullBath'].fillna(0)\n",
        "df['BsmtHalfBath'] = df['BsmtHalfBath'].fillna(0)\n",
        "df['TotalBsmtSF'] = df['TotalBsmtSF'].fillna(0)\n",
        "df['GarageArea'] = df['GarageArea'].fillna(0)\n",
        "df = df.drop(columns=['PID'])\n",
        "\n",
        "\n",
        "df = df[target_columns]\n",
        "\n",
        "# 5. ë²”ì£¼í˜• ë³€ìˆ˜ ì²˜ë¦¬í•˜ê¸°\n",
        "# 5ï¸-1. ë²”ì£¼í˜• ë³€ìˆ˜ â†’ ìˆ˜ì¹˜í˜• ë³€í™˜ (Ordinal Encoding)\n",
        "# ë²”ì£¼í˜• ë³€ìˆ˜ ìˆ˜ì¹˜í™” (Ordinal Encoding)\n",
        "ordinal_mappings = {\n",
        "    'ExterQual': {'None': 0, 'Po': 1, 'Fa': 2, 'TA': 3, 'Gd': 4, 'Ex': 5},\n",
        "    'ExterCond': {'None': 0, 'Po': 1, 'Fa': 2, 'TA': 3, 'Gd': 4, 'Ex': 5},\n",
        "    'HeatingQC': {'None': 0, 'Po': 1, 'Fa': 2, 'TA': 3, 'Gd': 4, 'Ex': 5},\n",
        "    'GarageCond': {'None': 0, 'Po': 1, 'Fa': 2, 'TA': 3, 'Gd': 4, 'Ex': 5},\n",
        "    'BsmtCond': {'None': 0, 'Po': 1, 'Fa': 2, 'TA': 3, 'Gd': 4, 'Ex': 5},\n",
        "    'BsmtQual': {'None': 0, 'Po': 1, 'Fa': 2, 'TA': 3, 'Gd': 4, 'Ex': 5},\n",
        "    'KitchenQual': {'None': 0, 'Po': 1, 'Fa': 2, 'TA': 3, 'Gd': 4, 'Ex': 5},\n",
        "    'GarageQual': {'None': 0, 'Po': 1, 'Fa': 2, 'TA': 3, 'Gd': 4, 'Ex': 5},\n",
        "}\n",
        "\n",
        "# ë§¤í•‘ ì ìš©\n",
        "for col, mapping in ordinal_mappings.items():\n",
        "    df[col] = df[col].map(mapping)\n",
        "\n",
        "df = pd.get_dummies(df, columns=['RoofStyle', 'Exterior1st', 'Foundation', 'PavedDrive'], drop_first=True)\n",
        "\n",
        "\n",
        "# 6ï¸. ê²°ì¸¡ì¹˜ í™•ì¸\n",
        "print(df.isnull().sum())\n",
        "\n",
        "\n",
        "# LassoCV (ë³€ìˆ˜ 39ê°œ)\n",
        "import pandas as pd\n",
        "from sklearn.linear_model import LassoCV\n",
        "from sklearn.preprocessing import StandardScaler\n",
        "\n",
        "# ë…ë¦½ë³€ìˆ˜(X), ì¢…ì†ë³€ìˆ˜(y) ë¶„ë¦¬\n",
        "X = df.drop(columns=['SalePrice'])\n",
        "y = df['SalePrice']\n",
        "\n",
        "# 1. ìŠ¤ì¼€ì¼ë§ (í‘œì¤€í™”)\n",
        "scaler = StandardScaler()\n",
        "X_scaled = scaler.fit_transform(X)  # Xë¥¼ í‰ê·  0, í‘œì¤€í¸ì°¨ 1ë¡œ ë³€í™˜\n",
        "\n",
        "# 2ï¸. LassoCV í•™ìŠµ (êµì°¨ê²€ì¦ìœ¼ë¡œ alpha ì°¾ê¸°)\n",
        "lasso = LassoCV(cv=5, random_state=2025)\n",
        "lasso.fit(X_scaled, y)\n",
        "\n",
        "# 3. ê²°ê³¼ í™•ì¸\n",
        "best_alpha = lasso.alpha_\n",
        "coefficients = lasso.coef_\n",
        "\n",
        "# 4. ê³„ìˆ˜ì™€ ë³€ìˆ˜ëª…ì„ ë°ì´í„°í”„ë ˆì„ìœ¼ë¡œ ì •ë¦¬\n",
        "coef_df = pd.DataFrame({\n",
        "    'Feature': X.columns,\n",
        "    'Coefficient': coefficients\n",
        "}).sort_values(by='Coefficient', key=abs, ascending=False)\n",
        "\n",
        "print(f\"Best alpha: {best_alpha}\")\n",
        "print(coef_df)\n",
        "\n",
        "\n",
        "\n",
        "# Lasso alpha\n",
        "from sklearn.linear_model import Lasso\n",
        "from sklearn.metrics import mean_squared_error\n",
        "import matplotlib.pyplot as plt\n",
        "\n",
        "# ê¸°ì¤€ alpha (LassoCVì—ì„œ ë‚˜ì˜¨ ê°’)\n",
        "base_alpha = lasso.alpha_\n",
        "\n",
        "# ì‹¤í—˜í•  alpha ë°°ìˆ˜ë“¤\n",
        "alpha_multipliers = [0.5, 1, 2, 5, 10, 15, 20, 25]\n",
        "results = []\n",
        "\n",
        "# ë°˜ë³µí•´ì„œ ëª¨ë¸ ëŒë¦¬ê¸°\n",
        "for m in alpha_multipliers:\n",
        "    alpha = base_alpha * m\n",
        "    model = Lasso(alpha=alpha, max_iter=10000)\n",
        "    model.fit(X_scaled, y)\n",
        "    coef = model.coef_\n",
        "    num_nonzero = np.sum(coef != 0)\n",
        "    y_pred = model.predict(X_scaled)\n",
        "    mse = mean_squared_error(y, y_pred)\n",
        "\n",
        "    results.append({\n",
        "        'alpha': round(alpha, 5),\n",
        "        'multiplier': m,\n",
        "        'num_features': num_nonzero,\n",
        "        'mse': round(mse, 2)\n",
        "    })\n",
        "\n",
        "    # ë‚¨ì•„ ìˆëŠ” ë³€ìˆ˜ ì¶œë ¥\n",
        "    print(f\"\\n[alpha = {alpha:.5f}]\")\n",
        "    print(f\"ë‚¨ì€ ë³€ìˆ˜ ê°œìˆ˜: {num_nonzero}\")\n",
        "    print(\"ì„ íƒëœ ë³€ìˆ˜:\")\n",
        "    print(pd.Series(X.columns[coef != 0]).values)\n",
        "\n",
        "# ê²°ê³¼ DataFrameìœ¼ë¡œ ì •ë¦¬\n",
        "results_df = pd.DataFrame(results)\n",
        "print(\"\\nğŸ“Š Alphaë³„ ê²°ê³¼:\")\n",
        "print(results_df)"
      ],
      "id": "a8c9bb52",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "import matplotlib.pyplot as plt\n",
        "\n",
        "# ê·¸ë˜í”„ë¡œ ë³´ê¸°\n",
        "plt.figure(figsize=(10, 5))\n",
        "plt.plot(results_df['alpha'], results_df['num_features'], marker='o', label='Selected Features')\n",
        "plt.xlabel('Alpha')\n",
        "plt.ylabel('Number of Selected Features')\n",
        "plt.title('Alpha ê°’ì— ë”°ë¥¸ ë³€ìˆ˜ ì„ íƒ ê°œìˆ˜ ë³€í™”')\n",
        "plt.grid(True)\n",
        "plt.legend()\n",
        "plt.show()"
      ],
      "id": "c9cf0e48",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "#### ìµœì¢… ë³€ìˆ˜\n",
        "\n",
        "\n",
        "| ëª¨ë¸     | Adj. R-squared | AIC     |\n",
        "|----------|----------------|---------|\n",
        "| Model 1  | 0.852          | 58050   |\n",
        "| Model 2  | 0.853          | 58030   |\n",
        "\n",
        "- ìµœì¢… ë³€ìˆ˜\n",
        "    'GrLivArea', 'TotalBsmtSF', 'GarageArea', \n",
        "    'OverallQual', 'KitchenQual', 'BsmtQual', 'ExterQual', \n",
        "    'OverallCond', 'BsmtFullBath',\n",
        "    'YearBuilt' \n"
      ],
      "id": "ecc0541a"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "#| echo: false\n",
        "#| include: false\n",
        "\n",
        "from sklearn.linear_model import LassoCV\n",
        "lasso = LassoCV(cv=5).fit(X_scaled, y)\n",
        "top_features = coef_df[coef_df[\"Coefficient\"] != 0]['Feature'].head(10).tolist()"
      ],
      "id": "996ab65f",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "#| echo: false\n",
        "#| include: false\n",
        "from sklearn.model_selection import GridSearchCV, KFold\n",
        "\n",
        "# alphaë¡œ ì°¾ê¸°\n",
        "selected_features = ['OverallQual', 'ExterQual', 'KitchenQual' ,'YearBuilt', 'BsmtFullBath',\n",
        "'GrLivArea', 'TotalBsmtSF' ,'GarageArea' ,'WoodDeckSF','RoofStyle_Hip' ]\n",
        "\n",
        "# ì ˆëŒ€ê°’ìœ¼ë¡œ 10ê°œ ì°¾ê¸°\n",
        "# 1. ì¢…ì†ë³€ìˆ˜ ë¡œê·¸ ë³€í™˜\n",
        "y = (df['SalePrice'])  # log(1 + y)\n",
        "\n",
        "# 2. ìƒìœ„ 10ê°œ í”¼ì²˜ ì„ íƒ (ê¸°ì¡´ coef_df ê¸°ì¤€)\n",
        "top_features = coef_df[coef_df[\"Coefficient\"] != 0]['Feature'].head(10).tolist()\n",
        "X = df[top_features]\n",
        "\n",
        "# 3. ìŠ¤ì¼€ì¼ë§\n",
        "scaler = StandardScaler()\n",
        "X_scaled = scaler.fit_transform(X)\n",
        "\n",
        "# 4. Lasso + GridSearchCV ì„¤ì •\n",
        "lasso = Lasso(max_iter=10000)\n",
        "alphas = np.linspace(0.01, 1, 100)\n",
        "cv = KFold(n_splits=5, shuffle=True, random_state=2025)\n",
        "grid = GridSearchCV(estimator=lasso, param_grid={'alpha': alphas},\n",
        "                    cv=cv, scoring='neg_mean_squared_error')\n",
        "grid.fit(X_scaled, y)"
      ],
      "id": "3979f0a4",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "# 5. ìµœì  alpha ë° ì„±ëŠ¥ í™•ì¸\n",
        "print(\"Best alpha:\", grid.best_params_['alpha'])\n",
        "print(\"Best CV Score (MSE):\", -grid.best_score_)\n",
        "\n",
        "# 6. íšŒê·€ ê³„ìˆ˜ ì¶œë ¥\n",
        "coef_df_top = pd.DataFrame({\n",
        "    'Feature': top_features,\n",
        "    'Coefficient': grid.best_estimator_.coef_}).sort_values(by='Coefficient', key=abs, ascending=False)\n",
        "\n",
        "print(coef_df_top)"
      ],
      "id": "8532995f",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "# ìœ ì§€ë³´ìˆ˜ ì ìˆ˜í™” ê³¼ì •\n",
        "\n",
        "### \n",
        "ğŸ“Œ **ì ìˆ˜í™” ê³¼ì •**\n",
        "\n",
        "âœ”ï¸ 10ê°œ ì„ ì •ëœ ë³€ìˆ˜ë“¤ ì‚¬ì´ì—ì„œ ì´ìƒì¹˜ ì²´í¬<br>\n",
        "âœ”ï¸ MinMaxScaler ì ìš©í•˜ê¸°<br>\n",
        "âœ”ï¸ ë©´ì , í’ˆì§ˆ, ìƒíƒœ, ì—°ì‹ scoreë¡œ ë§Œë“¤ê¸°<br>\n",
        "âœ”ï¸ score ë³„ ê°€ì¤‘ì¹˜ ê³±í•˜ê³  í•©ì‚° ì§„í–‰<br>\n",
        "âœ”ï¸ ê°€ì¤‘ì¹˜ ì»¬ëŸ¼(MaintenanceScore)ì„ ë§Œë“¤ê¸°<br>\n",
        "\n",
        "\n",
        "\n",
        "### ìœ ì§€ë³´ìˆ˜ ì ìˆ˜í™” ê³„ì‚° ë‹¨ê³„ {.tabset}\n",
        "\n",
        "\n",
        "#### ğŸ“Œ Step 1\n",
        "\n",
        "- ì„ ì •í•œ 10ê°œ ë³€ìˆ˜ë“¤ ì‚¬ì´ ì´ìƒì¹˜ë¥¼ í™•ì¸<br>\n",
        "- **GrLivArea**, **GarageArea**, **TotalBsmtSF**ì—ì„œ ì´ìƒì¹˜ ì œê±°<br>\n"
      ],
      "id": "0af13eaf"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "#| echo: False\n",
        "#| include: true\n",
        "import matplotlib.pyplot as plt\n",
        "import seaborn as sns\n",
        "\n",
        "# ì´ìƒì¹˜ ì‹œê°í™”\n",
        "fig = plt.figure(figsize=(16, 12))\n",
        "for i, col in enumerate(top_features):\n",
        "    ax = fig.add_subplot(4, 3, i + 1)\n",
        "    sns.scatterplot(data=df, x=col, y='SalePrice', s=20, ax=ax)\n",
        "    _ = ax.set_xlabel(col)\n",
        "    _ = ax.set_ylabel('')\n",
        "\n",
        "plt.tight_layout()\n",
        "plt.show()\n",
        "\n",
        "# ì´ìƒì¹˜ ì¡°ê±´\n",
        "condition = (\n",
        "    (df['GrLivArea'] <= 3500) &\n",
        "    (df['GarageArea'] <= 1200) &\n",
        "    (df['TotalBsmtSF'] <= 2500)\n",
        ")\n",
        "\n",
        "# ì´ìƒì¹˜ ì œê±°\n",
        "df_clean = df[condition].copy()"
      ],
      "id": "9760eebc",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "#### ğŸ“Œ Step 2\n",
        "\n",
        "- **MinMaxScaler**ë¥¼ ì ìš©í•˜ê¸° <br>\n",
        "    - ë‹¨ìœ„ê°€ ì œê°ê°ì¼ ê²½ìš° ì—°ì‚°ì´ë‚˜ ê±°ë¦¬ ê¸°ë°˜ ê³„ì‚°ì„ í• ë•Œ ì˜í–¥ì„ í¬ê²Œ ë°›ëŠ” ë³€ìˆ˜ê°€ ì™œê³¡ ë  ìˆ˜ ìˆìŒ.<br>\n",
        "    - ì„œë¡œ ë‹¤ë¥¸ ë‹¨ìœ„ë¥¼ ê°–ëŠ” ë³€ìˆ˜ë“¤ì„ ë™ì¼í•œ ë²”ìœ„(0~1)ë¡œ ìŠ¤ì¼€ì¼ë§í•˜ì—¬ ë¹„êµ ê°€ëŠ¥í•˜ê²Œ ë§Œë“¤ê¸° ìœ„í•´ì„œ! <br>\n",
        "    - ìµœì†Œê°’ì€ 0, ìµœëŒ€ê°’ì€ 1ë¡œ ë§ì¶°ì£¼ëŠ” ë°©ì‹\n",
        "\n",
        "\n",
        "#### ğŸ“Œ Step 3\n",
        "\n",
        "- ê° ë³€ìˆ˜ë“¤ì„ **ë©´ì , í’ˆì§ˆ, ìƒíƒœ, ì—°ì‹**ìœ¼ë¡œ êµ¬ì„±\n",
        "    - area_score(ë©´ì ) : 'GrLivArea', 'TotalBsmtSF', 'GarageArea'<br>\n",
        "    - quality_score(í’ˆì§ˆ) : 'OverallQual', 'KitchenQual', 'BsmtQual', 'ExterQual'<br>\n",
        "    - condition_score(ìƒíƒœ) : 'OverallCond', 'BsmtFullBath'<br>\n",
        "    - year_score(ì—°ì‹) : 'YearBuilt'<br>\n",
        "<br>\n",
        "<br>\n",
        "- ê° scoreë¥¼ ì•„ë˜ì™€ ê°™ì´ ê³„ì‚°<br>\n",
        "    - area_score = df_clean['GrLivArea'] + df_clean['TotalBsmtSF'] + df_clean['GarageArea']<br>\n",
        "    - quality_score = (1 - df_clean['OverallQual']) + (1 - df_clean['KitchenQual']) + (1 - df_clean['BsmtQual']) + (1 - df_clean['ExterQual'])<br>\n",
        "    - condition_score = (1 - df_clean['OverallCond']) + (1 - df_clean['BsmtFullBath'])<br>\n",
        "    - year_score = 1 - df_clean['YearBuilt']<br>\n",
        "\n",
        "#### ğŸ“Œ Step 4\n",
        "- **quality_score** ì™€ **year_score**ì— ì¡°ê¸ˆ ë” ë¹„ì¤‘ì„ ë‘¬ì„œ ê°€ì¤‘ì¹˜ ì§„í–‰<br>\n",
        "<br>\n",
        "<br>\n",
        "\n",
        "- ê°€ì¤‘ì¹˜ë¥¼ ë‘¬ì„œ ê³„ì‚° ì§„í–‰\n",
        "    - df['MaintenanceScore'] = area_score * 0.2 + quality_score * 0.3 + condition_score * 0.2 + year_score * 0.3\n",
        "<br>\n",
        "<br>\n",
        "\n",
        "- **MaintenanceScore**ì„ A(ìµœìš°ìˆ˜),B(ì–‘í˜¸),C(ê°œì„ í•„ìš”),D(ì‹œê¸‰)ìœ¼ë¡œ êµ¬ë¶„\n"
      ],
      "id": "773159ad"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "#| echo: True\n",
        "#| include: false\n",
        "\n",
        "\n",
        "\n",
        "import pandas as pd\n",
        "from sklearn.preprocessing import MinMaxScaler\n",
        "\n",
        "\n",
        "# ìŠ¤ì¼€ì¼ë§í•  ë³€ìˆ˜ ëª©ë¡\n",
        "scale_columns = [\n",
        "    'GrLivArea', 'TotalBsmtSF', 'GarageArea',   # ë©´ì \n",
        "    'OverallQual', 'KitchenQual', 'BsmtQual', 'ExterQual',  # í’ˆì§ˆ\n",
        "    'OverallCond', 'BsmtFullBath',  # ìƒíƒœ\n",
        "    'YearBuilt'  # ì—°ì‹\n",
        "]\n",
        "\n",
        "# MinMaxScaler ì ìš© (0~1 ë²”ìœ„)\n",
        "scaler = MinMaxScaler()\n",
        "df_clean[scale_columns] = scaler.fit_transform(df_clean[scale_columns])\n",
        "df_clean = df_clean[scale_columns]\n",
        "\n",
        "\n",
        "# ë©´ì  ê·¸ëŒ€ë¡œ\n",
        "area_score = df_clean['GrLivArea'] + df_clean['TotalBsmtSF'] + df_clean['GarageArea']\n",
        "\n",
        "# í’ˆì§ˆ/ìƒíƒœ/ì—°ì‹ ë’¤ì§‘ê¸° (1 - ê°’)\n",
        "quality_score = (1 - df_clean['OverallQual']) + (1 - df_clean['KitchenQual']) + (1 - df_clean['BsmtQual']) + (1 - df_clean['ExterQual'])\n",
        "condition_score = (1 - df_clean['OverallCond']) + (1 - df_clean['BsmtFullBath'])\n",
        "year_score = 1 - df_clean['YearBuilt']  # ì—°ì‹ë„ ë°˜ì „\n",
        "\n",
        "# ê°€ì¤‘ì¹˜ ê³±í•˜ê³  í•©ì‚°\n",
        "df['MaintenanceScore'] = (\n",
        "    area_score * 0.2 +\n",
        "    quality_score * 0.3 +\n",
        "    condition_score * 0.2 +\n",
        "    year_score * 0.3\n",
        ")"
      ],
      "id": "a3e260f9",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "#### ğŸ“Œ Step 5\n",
        "\n",
        "- **MaintenanceScore** ë†’ë‹¤ëŠ” ê²ƒì€ ê°€ê²©ëŒ€ë¹„ ìœ ì§€ë³´ìˆ˜ê°€ ë†’ë‹¤ëŠ” ê²ƒ\n",
        "<br> => í•´ë‹¹ ì§‘ì€ í”¼í•´ì•¼í•˜ëŠ” ì§‘!\n",
        "<br>\n",
        "\n",
        "- **MaintenanceScore** ì˜ í‰ê· ê³¼ í‘œì¤€í¸ì°¨ë¥¼ í™œìš©í•˜ì—¬ ë“±ê¸‰ì„ ë‚˜ëˆ„ê¸°<br>\n",
        "    - **MaintenanceScore** >= mean + std ==> D (ì‹œê¸‰)\n",
        "    - **MaintenanceScore** >= mean       ==> C (ê°œì„ í•„ìš”)\n",
        "    - **MaintenanceScore** >= mean - std ==> B (ì–‘í˜¸)\n",
        "    - **MaintenanceScore** ê·¸ ì™¸         ==> A (ìµœìš°ìˆ˜)\n",
        "\n",
        "- ì™œ? í‰ê· ê³¼ í‘œì¤€í¸ì°¨ë¥¼ í™œìš©í•˜ëŠ” ê±¸ê¹Œ?\n",
        "    - ë¶„í¬ì˜ ì¤‘ì‹¬ê°’(í‰ê· )ì„ ê¸°ì¤€ìœ¼ë¡œ íŒë‹¨í•˜ë‹ˆ, ì „ì²´ ë°ì´í„° ë¹„êµì— ìœ ë¦¬\n",
        "    - ì ˆëŒ€ê°’ ê¸°ì¤€ë³´ë‹¤ ëœ ì™œê³¡ë¨\n"
      ],
      "id": "35691f11"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "#| echo: True\n",
        "#| include: false\n",
        "\n",
        "selected_features = ['OverallQual', 'ExterQual', 'KitchenQual' ,'YearBuilt', 'BsmtFullBath',\n",
        "'GrLivArea', 'TotalBsmtSF' ,'GarageArea' ,'WoodDeckSF','RoofStyle_Hip' ]\n",
        "\n",
        "df_copy = df[condition].copy()\n",
        "\n",
        "\n",
        "\n",
        "mean = df['MaintenanceScore'].mean()\n",
        "std = df['MaintenanceScore'].std()\n",
        "\n",
        "\n",
        "# ì´ê±´ ì •ê·œë¶„í¬ ë˜ëŠ” ë¹„ìŠ·í•œ ë¶„í¬ë¥¼ ê°€ì§„ ì ìˆ˜ê°’ë“¤ì„\n",
        "# ìƒëŒ€ì ìœ¼ë¡œ ë‚˜ëˆ„ê¸° ìœ„í•œ ì¼ë°˜ì ì¸ ì „ëµ\n",
        "# ì ìˆ˜ê°€ ëª‡ ì ì´ ë†’ê³  ë‚®ì€ì§€ ëª…í™•íˆ ê¸°ì¤€ì„ ì œì‹œí•  ìˆ˜ ìˆì–´.\n",
        "# ë¶„í¬ì˜ ì¤‘ì‹¬ê°’(í‰ê· )ì„ ê¸°ì¤€ìœ¼ë¡œ íŒë‹¨í•˜ë‹ˆ, ì „ì²´ ë°ì´í„° ë¹„êµì— ìœ ë¦¬.\n",
        "# ì ˆëŒ€ê°’ ê¸°ì¤€ë³´ë‹¤ ëœ ì™œê³¡ë¨, íŠ¹íˆ ìŠ¤ì¼€ì¼ë§ëœ ë°ì´í„°ì—ì„œëŠ” ë”ìš±!\n",
        "\n",
        "\n",
        "def hybrid_grade(score):\n",
        "    if score >= mean + std:\n",
        "        return \"D (ì‹œê¸‰)\"\n",
        "    elif score >= mean:\n",
        "        return \"C (ê°œì„  í•„ìš”)\"\n",
        "    elif score >= mean - std:\n",
        "        return \"B (ì–‘í˜¸)\"\n",
        "    else:\n",
        "        return \"A (ìµœìš°ìˆ˜)\"\n",
        "\n",
        "df_copy['MaintenanceGrade'] = df['MaintenanceScore'].apply(hybrid_grade)"
      ],
      "id": "7dfdee57",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "<div style=\"all: unset; font-family: sans-serif; font-size: 16px; color: black; line-height: 1.6;\">\n",
        "::: {.no-style}\n",
        "\n",
        "\n",
        "\n",
        "# ê²°ë¡  \n",
        "\n",
        "\n",
        "\n",
        "\n",
        "\n",
        "::: {.card title=\"**ë“±ê¸‰ êµ¬ê°„ ë³„ ë¶„í¬**\"}\n"
      ],
      "id": "3b4f810b"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "grade_order = ['A (ìµœìš°ìˆ˜)', 'B (ì–‘í˜¸)', 'C (ê°œì„  í•„ìš”)', 'D (ì‹œê¸‰)']\n",
        "df_copy['MaintenanceGrade'] = pd.Categorical(df_copy['MaintenanceGrade'],\n",
        "                                            categories=grade_order,\n",
        "                                            ordered=True)\n",
        "                                            \n",
        "plt.figure(figsize=(8, 6))\n",
        "sns.scatterplot(data=df_copy, x='MaintenanceScore', y='SalePrice', hue='MaintenanceGrade')\n",
        "_ = plt.title(\"SalePrice vs MaintenanceScore\")\n",
        "_ = plt.xlabel(\"Maintenance Score\")\n",
        "_ = plt.ylabel(\"Sale Price\")\n",
        "plt.grid(True)\n",
        "plt.show()"
      ],
      "id": "c4d87a49",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        ":::\n",
        "\n",
        "\n",
        "::: {.card title=\"**Aë“±ê¸‰ ì¤‘ ê°€ê²©ì´ ë‚®ì€ ìƒìœ„ 10ê°œ ì§‘**\"}\n"
      ],
      "id": "3be5b13f"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "# 1. Dë“±ê¸‰ë§Œ í•„í„°ë§ + ì •ë ¬ (ë¡œì»¬ì—ì„œ ë‹¤ì‹œ ì •ì˜)\n",
        "df_copy_d = df_copy[df_copy['MaintenanceGrade'] == 'A (ìµœìš°ìˆ˜)'].copy()\n",
        "df_d_sorted = df_copy_d.sort_values(by='SalePrice', ascending=True)\n",
        "\n",
        "# 2. ìƒìœ„ 10ê°œ ì„ íƒ\n",
        "top10_d = df_d_sorted.head(10)\n",
        "import plotly.express as px\n",
        "\n",
        "top10_d[selected_features]\n",
        "top10_d = top10_d.reset_index()\n",
        "\n",
        "# 3. ì§€ë„ ì‹œê°í™”\n",
        "fig = px.scatter_mapbox(\n",
        "    top10_d,\n",
        "    lat=\"Latitude\",\n",
        "    lon=\"Longitude\",\n",
        "    color=\"SalePrice\",\n",
        "    size=\"SalePrice\",\n",
        "    color_continuous_scale=\"Reds\",\n",
        "    size_max=15,\n",
        "    zoom=11,\n",
        "    mapbox_style=\"carto-positron\",\n",
        "    hover_data=[\"SalePrice\", \"MaintenanceGrade\", \"YearBuilt\", \"GrLivArea\",\"index\"]\n",
        ")\n",
        "\n",
        "fig.update_layout(\n",
        "    title=\"Top 10 A-Grade Houses (Low Price & Low Maintenance Score)\",\n",
        "    width=950,\n",
        "\n",
        "    margin={\"r\":30,\"t\":30,\"l\":0,\"b\":0}\n",
        ")\n"
      ],
      "id": "c4a3a4a3",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        ":::\n",
        "\n",
        "\n",
        "::: {.card title=\"**ë“±ê¸‰ ë³„ ë¶„í¬ ì§€ë„ ì‹œê°í™”**\"}\n"
      ],
      "id": "84e9d4cf"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "fig = px.scatter_mapbox(\n",
        "    df_copy,\n",
        "    lat=\"Latitude\",\n",
        "    lon=\"Longitude\",\n",
        "    color=\"MaintenanceGrade\",  # ë“±ê¸‰ë³„ ìƒ‰ìƒ êµ¬ë¶„\n",
        "    category_orders={\n",
        "        \"MaintenanceGrade\": [\"A (ìµœìš°ìˆ˜)\", \"B (ì–‘í˜¸)\", \"C (ê°œì„  í•„ìš”)\", \"D (ì‹œê¸‰)\"]\n",
        "    },\n",
        "    mapbox_style=\"carto-positron\",\n",
        "    zoom=11,\n",
        "    size=\"SalePrice\",  # í˜¹ì€ GrLivAreaë„ ê°€ëŠ¥\n",
        "    size_max=12,\n",
        "    hover_data=[\"SalePrice\", \"MaintenanceGrade\", \"YearBuilt\", \"GrLivArea\"]\n",
        ")\n",
        "\n",
        "fig.update_layout(\n",
        "    title=\"Maintenance Grade of All Properties in Ames Housing\",\n",
        "    width=950,\n",
        "    margin={\"r\":30,\"t\":30,\"l\":0,\"b\":0}\n",
        "\n",
        ")\n"
      ],
      "id": "8dbbc898",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        ":::\n",
        "\n",
        "::: {.card title=\"**ì§€ì—­ë³„ í‰ê·  MaintenanceScore**\"}\n"
      ],
      "id": "6d69a56a"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "import seaborn as sns\n",
        "\n",
        "\n",
        "origin_data = pd.read_csv(\"./plotly_data/ames.csv\")\n",
        "df_neigh = origin_data[[ 'Neighborhood']]  # ë˜ëŠ” 'Id'ê°€ ê¸°ì¤€ì´ë¼ë©´ ê·¸ê±¸ë¡œ\n",
        "df_copy = df_copy.merge(origin_data[['Neighborhood']], left_index=True, right_index=True)\n",
        "\n",
        "\n",
        "\n",
        "pivot = df_copy.pivot_table(index=\"Neighborhood\", values=\"MaintenanceScore\", aggfunc=\"mean\")\n",
        "plt.figure(figsize=(8, 10))\n",
        "sns.heatmap(pivot.sort_values(\"MaintenanceScore\", ascending=False), cmap=\"RdYlGn_r\", annot=True)\n",
        "plt.title(\"Neighborhood-wise Average Maintenance Score\")\n",
        "plt.show()"
      ],
      "id": "ad2e90f3",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        ":::\n",
        "\n",
        "::: {.card title=\"**ì§€ì—­ ë³„ ê°€ì¥ ë§ì´ ë¶„í¬ëœ ìœ ì§€ë³´ìˆ˜ ë“±ê¸‰ **\"}\n"
      ],
      "id": "8f42d83d"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "###########################################\n",
        "# Neighborhoodë³„ ì§€ë„ ì‹œê°í™”\n",
        "\n",
        "\n",
        "\n",
        "\n",
        "\n",
        "# 1. ë“±ê¸‰ ë¹„ìœ¨ ê³„ì‚°\n",
        "grade_pct = pd.crosstab(df_copy['Neighborhood'], df_copy['MaintenanceGrade'])\n",
        "grade_pct = grade_pct.div(grade_pct.sum(axis=1), axis=0) * 100\n",
        "\n",
        "# 2. ê°€ì¥ ë§ì€ ë“±ê¸‰ ì„ íƒ\n",
        "grade_pct['DominantGrade'] = grade_pct.idxmax(axis=1)\n",
        "\n",
        "# 3. ì¢Œí‘œ í‰ê· \n",
        "coords = df_copy.groupby('Neighborhood')[['Latitude', 'Longitude']].mean()\n",
        "\n",
        "# 4. ë³‘í•©\n",
        "import plotly.express as px\n",
        "house_counts = df_copy['Neighborhood'].value_counts().rename(\"NumHouses\")\n",
        "# 5. ë³‘í•© í›„ í‘œë³¸ ìˆ˜ê¹Œì§€ ì¶”ê°€\n",
        "neigh_dominant = grade_pct[['DominantGrade']].merge(coords, left_index=True, right_index=True)\n",
        "neigh_dominant = neigh_dominant.merge(house_counts, left_on='Neighborhood', right_index=True).reset_index()\n",
        "\n",
        "fig = px.scatter_mapbox(\n",
        "    neigh_dominant,\n",
        "    lat=\"Latitude\",\n",
        "    lon=\"Longitude\",\n",
        "    size=\"NumHouses\", \n",
        "    color=\"DominantGrade\", \n",
        "    color_discrete_sequence=px.colors.qualitative.Set2,\n",
        "    category_orders={\n",
        "    \"DominantGrade\": [\"A (ìµœìš°ìˆ˜)\", \"B (ì–‘í˜¸)\", \"C (ê°œì„  í•„ìš”)\", \"D (ì‹œê¸‰)\"]\n",
        "    },\n",
        "    mapbox_style=\"carto-positron\",\n",
        "    zoom=11,\n",
        "    size_max=30,\n",
        "    hover_name=\"Neighborhood\",\n",
        "    hover_data={\"DominantGrade\": True, \"Latitude\": False, \"Longitude\": False}\n",
        ")\n",
        "\n",
        "fig.update_layout(\n",
        "    title=\" Dominant Grade by Neighborhood\",\n",
        "    width=950,\n",
        "    margin={\"r\":30,\"t\":30,\"l\":0,\"b\":0}\n",
        ")\n"
      ],
      "id": "4da08528",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "::: \n"
      ],
      "id": "474fd160"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "#| echo: false\n",
        "#| include: false\n",
        "####  ê²Œì´ì§€ ì°¨íŠ¸ ì‹œê°í™” : ì¤‘ê°„ ìˆ«ìëŠ” í‰ê·  ê°€ê²©\n",
        "\n",
        "# í‰ê·  ê³„ì‚°\n",
        "species_avg = df_copy.groupby(\"MaintenanceGrade\")[\"SalePrice\"].mean().reindex(\n",
        "    [\"A (ìµœìš°ìˆ˜)\", \"B (ì–‘í˜¸)\", \"C (ê°œì„  í•„ìš”)\", \"D (ì‹œê¸‰)\"]\n",
        ")\n",
        "\n",
        "# ìµœëŒ€ê°’ ì„¤ì •\n",
        "max_val = df_copy[\"SalePrice\"].max()\n",
        "import plotly.graph_objects as go\n",
        "# ê·¸ë˜í”„ ìƒì„±\n",
        "fig = go.Figure()\n",
        "\n",
        "for i, (grade, avg_price) in enumerate(species_avg.items()):\n",
        "    fig.add_trace(go.Indicator(\n",
        "        mode=\"gauge+number\",\n",
        "        value=round(avg_price / 1000),  # ì²œ ë‹¨ìœ„ kë¡œ í‘œì‹œ\n",
        "        number={\"suffix\": \"k\", \"font\": {\"size\": 40}},\n",
        "        title={'text': f\"<b>{grade}</b>\", \"font\": {\"size\": 18}},\n",
        "        domain={'row': i // 2, 'column': i % 2},  # 2í–‰ 2ì—´\n",
        "        gauge={\n",
        "            'axis': {'range': [0, round(max_val / 1000)], 'tickformat': 'k'},\n",
        "            'bar': {'color': 'darkblue'},\n",
        "            'steps': [\n",
        "                {'range': [0, round(max_val * 0.5 / 1000)], 'color': '#d0f0f5'},\n",
        "                {'range': [round(max_val * 0.5 / 1000), round(max_val / 1000)], 'color': '#9dddf2'}\n",
        "            ],\n",
        "        }\n",
        "    ))\n",
        "\n",
        "# ë ˆì´ì•„ì›ƒ ì ìš©\n",
        "fig.update_layout(\n",
        "    grid={'rows': 2, 'columns': 2, 'pattern': \"independent\"},\n",
        "    title=\"<b>MaintenanceGrade vs. Average SalePrice</b>\",\n",
        "    width=1000,\n",
        "    font=dict(family=\"Arial\", size=14)\n",
        ")\n"
      ],
      "id": "f8260a53",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "::: {.card title=\"**ë“±ê¸‰ ë³„ í‰ê·  SalePrice **\"}\n"
      ],
      "id": "18005f55"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "fig.show()"
      ],
      "id": "5f1902b1",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        ":::\n",
        "\n",
        ":::\n",
        "\n",
        "</div>\n"
      ],
      "id": "36e6f485"
    }
  ],
  "metadata": {
    "kernelspec": {
      "display_name": "Python 3",
      "language": "python",
      "name": "python3"
    }
  },
  "nbformat": 4,
  "nbformat_minor": 5
}