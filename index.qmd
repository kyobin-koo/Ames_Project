---
title: "5ì¡° Ames Project"
format:
    dashboard:
        logo: logo.png
        # css: styles.css
        page-layout: dashboard
---


# ëª©ì 

## Row

### {.tabset}


#### ğŸ’¡ ë¯¸êµ­ ì§‘ ë§¤ë§¤ ì˜ˆì‚°ì•ˆ

- ë¯¸êµ­ Amesì— ì§‘ ë§¤ë§¤ ì˜ˆì‚°ì•ˆ êµ¬ì„±
    - ì£¼íƒ ê°€ê²© <br>
    - í´ë¡œì§• ë¹„ìš© : ë°”ì´ì–´ì™€ ì…€ëŸ¬ê°€ ì§€ë¶ˆí•˜ëŠ” ë¹„ìš© <br>
    - ìœ ì§€ ë° ê´€ë¦¬ ë¹„ìš© : êµ¬ë§¤í•œ í›„ì— ë“¤ì–´ê°€ëŠ” ìœ ì§€ ë° ê´€ë¦¬ ë¹„ìš© <br>


#### ğŸ’¡ ë¯¸êµ­ì˜ ì§‘ê°’ì€

![](./homerepair.PNG){width=500px}
<br>
<br>
- **ë¯¸êµ­ ì—°ê°„ ìœ ì§€ë¹„ìš©**ì— ëŒ€í•œ ê¶Œì¥ì‚¬í•­ì€ ì£¼íƒ ì›ë˜ ê°€ê²©ì˜ 1.5% ~ 4%ê¹Œì§€ ë‹¤ì–‘í•¨.<br>
ex) 70ë§Œ ë‹¬ëŸ¬ì— ì£¼íƒì„ êµ¬ë§¤í•œë‹¤ë©´ ì—°ê°„ 10,500~28,000 ë‹¬ëŸ¬ë¥¼ ìœ ì§€ë¹„ë¡œ ì§€ì¶œ<br>


#### ğŸ’¡ ëª©ì 

ğŸ“ ìœ ì§€ ë° ê´€ë¦¬ ë¹„ìš© â¬‡  ë§¤ë§¤ ê°€ê²© â¬‡ ì§‘ì„ ì°¾ì•„ë³´ì!
<br>
<br>
ğŸ‘€ " ì €ë ´í•œ ì§‘ê°’ë§Œ ë³´ê³  ìƒ€ë‹¤ê°€ ìœ ì§€ë¹„ í­íƒ„?"
<br>
<br>
í”„ë¡œì íŠ¸ ëª©ì  : ì§€ê¸ˆ ë‹¹ì¥ ë“œëŸ¬ë‚˜ëŠ” ê°€ê²©ë¿ ì•„ë‹ˆë¼, ì¥ê¸°ì ì¸ ìœ ì§€ ë¹„ìš©ê¹Œì§€ ê³ ë ¤í•œ â€˜ì§„ì§œ í•©ë¦¬ì ì¸ ì§‘ êµ¬ë§¤â€™ë¥¼ ê¿ˆê¾¸ëŠ” ì‚¬ëŒë“¤ì„ ìœ„í•œ Ames ë¶€ë™ì‚° ë¶„ì„ í”„ë¡œì íŠ¸



    
## Row 

```{python}
#| content: valuebox
#| title: "í’ˆì§ˆ / ìƒíƒœ"
#| icon: wrench
#| color: primary
dict(
    value = (14)
)

```

```{python}
#| content: valuebox
#| title: "ë©´ì "
#| color: primary
dict(
icon = "aspect-ratio",

value = (5))
```
```{python}
#| content: valuebox
#| title: "ìš•ì‹¤"
#| color: primary
dict(
icon = "droplet",

value = 4)
```

```{python}
#| content: valuebox
#| title: "ì—°ë„"
#| color: primary
dict(
icon = "calendar",

value = 3)
```

## Row


### í’ˆì§ˆ / ìƒíƒœ
- `OverallQual`  
- `OverallCond`  
- `RoofStyle`  
- `ExterQual`  
- `ExterCond`  
- `Exterior1st`  
- `HeatingQC`  
- `GarageCond`  
- `BsmtCond`  
- `BsmtQual`  
- `KitchenQual`  
- `GarageQual`  
- `Foundation`  
- `PavedDrive`


### ë©´ì  ê´€ë ¨
- `GrLivArea`  
- `TotalBsmtSF`  
- `GarageArea`  
- `WoodDeckSF`  
- `TotRmsAbvGrd`

### ìš•ì‹¤ ê´€ë ¨
- `FullBath`  
- `HalfBath`  
- `BsmtFullBath`  
- `BsmtHalfBath`

### ì—°ë„ ê´€ë ¨
- `YearBuilt`  
- `YearRemodAdd`  
- `GarageYrBlt`

```{python}
#| echo: true
#| include: false

import pandas as pd
import numpy as np
import matplotlib.pyplot as plt

df = pd.read_csv("./plotly_data/ames.csv")

# ì‚¬ìš©ìê°€ ì œì‹œí•œ ë³€ìˆ˜ ëª©ë¡ ì •ë¦¬
target_columns = [
    # í’ˆì§ˆ/ìƒíƒœ ê´€ë ¨
    'OverallQual', 'OverallCond', 'RoofStyle', 'ExterQual', 'ExterCond',
    'Exterior1st', 'HeatingQC', 'GarageCond', 'BsmtCond', 'BsmtQual',
    'KitchenQual', 'GarageQual', 'Foundation', 'PavedDrive',
    
    # ì—°ë„ ê´€ë ¨
    'YearBuilt', 'YearRemodAdd', 'GarageYrBlt',
    
    # ìš•ì‹¤ ê´€ë ¨
    'FullBath', 'HalfBath', 'BsmtFullBath', 'BsmtHalfBath',
    
    # ë©´ì  ê´€ë ¨
    'GrLivArea', 'TotalBsmtSF', 'GarageArea', 'WoodDeckSF',
    
    # ìœ„ì¹˜ ê´€ë ¨
    'TotRmsAbvGrd', 'Latitude', 'Longitude', 'SalePrice'
]

# ê²°ì¸¡ì¹˜ ê°œìˆ˜ í™•ì¸
missing_info = df[target_columns].isnull().sum()
missing_info = missing_info[missing_info > 0]
missing_info
df = df.dropna(subset=['Latitude', 'Longitude'])



# 4. ê²°ì¸¡ì¹˜ ì²˜ë¦¬ 
# 4-1. ì¹´í…Œê³ ë¦¬í˜• ê²°ì¸¡ì¹˜: ì§€í•˜ì‹¤/ì°¨ê³ ê°€ ì—†ëŠ” ê²½ìš° "None" ì²˜ë¦¬
df['GarageCond'] = df['GarageCond'].fillna("None")
df['BsmtCond'] = df['BsmtCond'].fillna("None")
df['BsmtQual'] = df['BsmtQual'].fillna("None")
df['GarageQual'] = df['BsmtQual'].fillna("None")

# 4-2. ìˆ˜ì¹˜í˜• ê²°ì¸¡ì¹˜: ì°¨ê³  ê±´ì¶•ì—°ë„ â†’ ì°¨ê³  ì—†ìŒì´ë©´ 0ìœ¼ë¡œ
df['GarageYrBlt'] = df['GarageYrBlt'].fillna(0)

df['BsmtFullBath'] = df['BsmtFullBath'].fillna(0)
df['BsmtHalfBath'] = df['BsmtHalfBath'].fillna(0)
df['TotalBsmtSF'] = df['TotalBsmtSF'].fillna(0)
df['GarageArea'] = df['GarageArea'].fillna(0)
df = df.drop(columns=['PID'])


df = df[target_columns]

# 5. ë²”ì£¼í˜• ë³€ìˆ˜ ì²˜ë¦¬í•˜ê¸°
# 5ï¸-1. ë²”ì£¼í˜• ë³€ìˆ˜ â†’ ìˆ˜ì¹˜í˜• ë³€í™˜ (Ordinal Encoding)
# ë²”ì£¼í˜• ë³€ìˆ˜ ìˆ˜ì¹˜í™” (Ordinal Encoding)
ordinal_mappings = {
    'ExterQual': {'None': 0, 'Po': 1, 'Fa': 2, 'TA': 3, 'Gd': 4, 'Ex': 5},
    'ExterCond': {'None': 0, 'Po': 1, 'Fa': 2, 'TA': 3, 'Gd': 4, 'Ex': 5},
    'HeatingQC': {'None': 0, 'Po': 1, 'Fa': 2, 'TA': 3, 'Gd': 4, 'Ex': 5},
    'GarageCond': {'None': 0, 'Po': 1, 'Fa': 2, 'TA': 3, 'Gd': 4, 'Ex': 5},
    'BsmtCond': {'None': 0, 'Po': 1, 'Fa': 2, 'TA': 3, 'Gd': 4, 'Ex': 5},
    'BsmtQual': {'None': 0, 'Po': 1, 'Fa': 2, 'TA': 3, 'Gd': 4, 'Ex': 5},
    'KitchenQual': {'None': 0, 'Po': 1, 'Fa': 2, 'TA': 3, 'Gd': 4, 'Ex': 5},
    'GarageQual': {'None': 0, 'Po': 1, 'Fa': 2, 'TA': 3, 'Gd': 4, 'Ex': 5},
}

# ë§¤í•‘ ì ìš©
for col, mapping in ordinal_mappings.items():
    df[col] = df[col].map(mapping)

df = pd.get_dummies(df, columns=['RoofStyle', 'Exterior1st', 'Foundation', 'PavedDrive'], drop_first=True)


# 6ï¸. ê²°ì¸¡ì¹˜ í™•ì¸
print(df.isnull().sum())


# LassoCV (ë³€ìˆ˜ 39ê°œ)
import pandas as pd
from sklearn.linear_model import LassoCV
from sklearn.preprocessing import StandardScaler

# ë…ë¦½ë³€ìˆ˜(X), ì¢…ì†ë³€ìˆ˜(y) ë¶„ë¦¬
X = df.drop(columns=['SalePrice'])
y = df['SalePrice']

# 1. ìŠ¤ì¼€ì¼ë§ (í‘œì¤€í™”)
scaler = StandardScaler()
X_scaled = scaler.fit_transform(X)  # Xë¥¼ í‰ê·  0, í‘œì¤€í¸ì°¨ 1ë¡œ ë³€í™˜

# 2ï¸. LassoCV í•™ìŠµ (êµì°¨ê²€ì¦ìœ¼ë¡œ alpha ì°¾ê¸°)
lasso = LassoCV(cv=5, random_state=2025)
lasso.fit(X_scaled, y)

# 3. ê²°ê³¼ í™•ì¸
best_alpha = lasso.alpha_
coefficients = lasso.coef_

# 4. ê³„ìˆ˜ì™€ ë³€ìˆ˜ëª…ì„ ë°ì´í„°í”„ë ˆì„ìœ¼ë¡œ ì •ë¦¬
coef_df = pd.DataFrame({
    'Feature': X.columns,
    'Coefficient': coefficients
}).sort_values(by='Coefficient', key=abs, ascending=False)

print(f"Best alpha: {best_alpha}")
print(coef_df)


X.columns

```



# ë³€ìˆ˜ ì„ íƒ

### {.tabset}

#### EDA ë°ì´í„° 

::: {.columns}

::: {.column width="50%"}

```{python}
#| echo: False
#| include: true


features = X.columns.tolist()

# í‰ê·  SalePrice by YearBuilt ê·¸ë˜í”„
ax = df.groupby("YearBuilt")["SalePrice"].mean().plot(
    kind="line", figsize=(10, 4), marker="o", color="royalblue"
)

ax.set_title("Average Sale Price by Year Built")
ax.set_xlabel("Year Built")
ax.set_ylabel("Average Sale Price")
ax.grid(True)
plt.tight_layout()
plt.show()

```

:::

::: {.column width="50%"}

```{python}
#| echo: False
#| include: true
#### EDA   ì—°ì‹ê³¼ ê°€ê²©ì„ í†µí•œ ì§€ë„ ì‹œê°í™” 2

import plotly.express as px

fig = px.scatter_mapbox(
    df,
    lat="Latitude",
    lon="Longitude",
    color="YearBuilt",           # ìƒ‰ìƒìœ¼ë¡œ ì—°ì‹ í‘œí˜„
    size="SalePrice",            # í¬ê¸°ë¡œ ê°€ê²© í‘œí˜„
    color_continuous_scale="Blues",
    size_max=15,
    zoom=11,
    mapbox_style="carto-positron",
    hover_data=["SalePrice", "YearBuilt", "GrLivArea", "OverallQual"]
)

fig.update_layout(
    title="Housing Age & Price on Map",
    width=950,
    height=600,
    margin={"r":0,"t":40,"l":0,"b":0}
)

fig.show()



```

:::

:::

#### ë°ì´í„° ì „ì²˜ë¦¬ ë° ê²°ì¸¡ì¹˜ ì²˜ë¦¬


::: {.columns}

::: {.column width="50%"}


- ì§€í•˜ì‹¤ ë° ì°¨ê³ ê°€ ì—†ëŠ” ê²½ìš°ëŠ” `'None'`ìœ¼ë¡œ ì±„ìš´ í›„, Ordinal Encodingì„ í†µí•´ ìˆ˜ì¹˜í™”í•¨.
- ì°¨ê³  ê±´ì¶• ì—°ë„(GarageYrBlt), ì§€í•˜ì‹¤ ìš•ì‹¤ ë“± ì¼ë¶€ ìˆ˜ì¹˜í˜• ê²°ì¸¡ì¹˜ëŠ” `0`ìœ¼ë¡œ ì²˜ë¦¬í•¨.
- ìµœì¢…ì ìœ¼ë¡œ 37ê°œ ì£¼ìš” ë³€ìˆ˜ ì¶”ì¶œí•¨.

- ê°ì„±ì  íŠ¹ì„±ê³¼ ê´€ê³„ëœ 30ì—¬ ê°œ ë³€ìˆ˜ ì„ ì •  
- í’ˆì§ˆ/ìƒíƒœ, ë©´ì , ìœ„ì¹˜, ì—°ë„, ìš•ì‹¤ ìˆ˜ ë“± í¬í•¨  
- ì¢…ì†ë³€ìˆ˜ëŠ” `SalePrice` ì‚¬ìš©
- `GarageCond`, `BsmtCond`, `BsmtQual`, `GarageQual` ë“±  
  â†’ ê²°ì¸¡ = í•´ë‹¹ í•­ëª© ì—†ìŒ â†’ `"None"`ìœ¼ë¡œ ì²˜ë¦¬
- `GarageYrBlt`, `BsmtFullBath`, `BsmtHalfBath`, `TotalBsmtSF`, `GarageArea`  
  â†’ ê²°ì¸¡ = êµ¬ì¡°ë¬¼ ì—†ìŒ â†’ `0`ìœ¼ë¡œ ëŒ€ì²´

- 1. ë²”ì£¼í˜• ë³€ìˆ˜ ìˆ˜ì¹˜í™”
- Ordinal Encoding
- í’ˆì§ˆ/ìƒíƒœ ê´€ë ¨: `"None"=0`, `"Po"=1` ~ `"Ex"=5`  
- ëŒ€ìƒ ë³€ìˆ˜: `ExterQual`, `HeatingQC`, `KitchenQual`, ë“±
- `RoofStyle`, `Exterior1st`, `Foundation`, `PavedDrive`  
  â†’ `pd.get_dummies`ë¡œ ì²˜ë¦¬ (ê¸°ì¤€ê°’ ì œì™¸)

:::

::: {.column width="50%"}

```{python}
from sklearn.linear_model import Lasso
from sklearn.metrics import mean_squared_error
import matplotlib.pyplot as plt
import matplotlib.pyplot as plt
import pandas as pd

# ê³„ìˆ˜ê°€ 0ì´ ì•„ë‹Œ ë³€ìˆ˜ë§Œ ì„ íƒ
selected_coef_df = coef_df[coef_df['Coefficient'] != 0].copy()

# ì ˆëŒ€ê°’ ê¸°ì¤€ ì •ë ¬
selected_coef_df = selected_coef_df.sort_values(by='Coefficient', key=abs, ascending=True)

# ì‹œê°í™”
plt.figure(figsize=(12, 10))
plt.barh(selected_coef_df['Feature'], selected_coef_df['Coefficient'])
plt.xlabel('Coefficient Value')
plt.title('LassoCV - Selected Feature Coefficients')
plt.grid(True)
plt.tight_layout()
plt.show()


```


:::

:::




#### ë³€ìˆ˜ ì„ ì • ë°©ë²•
-   1. **LassoCV ê¸°ë°˜ ë³€ìˆ˜ ì„ íƒ**
    - ë‹¤ì¤‘ê³µì„ ì„±ì„ ê³ ë ¤í•˜ì—¬ **LassoCV (5-Fold Cross Validation)** ë¥¼ ì ìš©.
    - ìµœì ì˜ alpha(209)ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë³€ìˆ˜ ì¶•ì†Œ.
<br>
<br>

-   2. **ìƒê´€ê³„ìˆ˜ ì ˆëŒ€ê°’ ê¸°ë°˜ ë³€ìˆ˜ ì„ íƒ**
    - ì ˆëŒ€ê°’ì„ ê¸°ì¤€ìœ¼ë¡œ ìƒìœ„ 10ê°œì¸ ìƒê´€ê³„ìˆ˜ ë³€ìˆ˜ ì„ íƒ.
    


```{python}
#| echo: true
#| include: false
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
from mpl_toolkits.mplot3d import Axes3D
import statsmodels.formula.api as smf
import seaborn as sns
from statsmodels.api import OLS
from statsmodels.formula.api import ols
import statsmodels.api as sm




df = pd.read_csv("./plotly_data/ames.csv")
# ì‚¬ìš©ìê°€ ì œì‹œí•œ ë³€ìˆ˜ ëª©ë¡ ì •ë¦¬
target_columns = [
    # í’ˆì§ˆ/ìƒíƒœ ê´€ë ¨
    'OverallQual', 'OverallCond', 'RoofStyle', 'ExterQual', 'ExterCond',
    'Exterior1st', 'HeatingQC', 'GarageCond', 'BsmtCond', 'BsmtQual',
    'KitchenQual', 'GarageQual', 'Foundation', 'PavedDrive',
    
    # ì—°ë„ ê´€ë ¨
    'YearBuilt', 'YearRemodAdd', 'GarageYrBlt',
    
    # ìš•ì‹¤ ê´€ë ¨
    'FullBath', 'HalfBath', 'BsmtFullBath', 'BsmtHalfBath',
    
    # ë©´ì  ê´€ë ¨
    'GrLivArea', 'TotalBsmtSF', 'GarageArea', 'WoodDeckSF',
    
    # ìœ„ì¹˜ ê´€ë ¨
    'TotRmsAbvGrd', 'Latitude', 'Longitude', 'SalePrice'
]

# ê²°ì¸¡ì¹˜ ê°œìˆ˜ í™•ì¸
missing_info = df[target_columns].isnull().sum()
missing_info = missing_info[missing_info > 0]
missing_info
df = df.dropna(subset=['Latitude', 'Longitude'])



# 4. ê²°ì¸¡ì¹˜ ì²˜ë¦¬ 
# 4-1. ì¹´í…Œê³ ë¦¬í˜• ê²°ì¸¡ì¹˜: ì§€í•˜ì‹¤/ì°¨ê³ ê°€ ì—†ëŠ” ê²½ìš° "None" ì²˜ë¦¬
df['GarageCond'] = df['GarageCond'].fillna("None")
df['BsmtCond'] = df['BsmtCond'].fillna("None")
df['BsmtQual'] = df['BsmtQual'].fillna("None")
df['GarageQual'] = df['BsmtQual'].fillna("None")

# 4-2. ìˆ˜ì¹˜í˜• ê²°ì¸¡ì¹˜: ì°¨ê³  ê±´ì¶•ì—°ë„ â†’ ì°¨ê³  ì—†ìŒì´ë©´ 0ìœ¼ë¡œ
df['GarageYrBlt'] = df['GarageYrBlt'].fillna(0)

df['BsmtFullBath'] = df['BsmtFullBath'].fillna(0)
df['BsmtHalfBath'] = df['BsmtHalfBath'].fillna(0)
df['TotalBsmtSF'] = df['TotalBsmtSF'].fillna(0)
df['GarageArea'] = df['GarageArea'].fillna(0)
df = df.drop(columns=['PID'])


df = df[target_columns]

# 5. ë²”ì£¼í˜• ë³€ìˆ˜ ì²˜ë¦¬í•˜ê¸°
# 5ï¸-1. ë²”ì£¼í˜• ë³€ìˆ˜ â†’ ìˆ˜ì¹˜í˜• ë³€í™˜ (Ordinal Encoding)
# ë²”ì£¼í˜• ë³€ìˆ˜ ìˆ˜ì¹˜í™” (Ordinal Encoding)
ordinal_mappings = {
    'ExterQual': {'None': 0, 'Po': 1, 'Fa': 2, 'TA': 3, 'Gd': 4, 'Ex': 5},
    'ExterCond': {'None': 0, 'Po': 1, 'Fa': 2, 'TA': 3, 'Gd': 4, 'Ex': 5},
    'HeatingQC': {'None': 0, 'Po': 1, 'Fa': 2, 'TA': 3, 'Gd': 4, 'Ex': 5},
    'GarageCond': {'None': 0, 'Po': 1, 'Fa': 2, 'TA': 3, 'Gd': 4, 'Ex': 5},
    'BsmtCond': {'None': 0, 'Po': 1, 'Fa': 2, 'TA': 3, 'Gd': 4, 'Ex': 5},
    'BsmtQual': {'None': 0, 'Po': 1, 'Fa': 2, 'TA': 3, 'Gd': 4, 'Ex': 5},
    'KitchenQual': {'None': 0, 'Po': 1, 'Fa': 2, 'TA': 3, 'Gd': 4, 'Ex': 5},
    'GarageQual': {'None': 0, 'Po': 1, 'Fa': 2, 'TA': 3, 'Gd': 4, 'Ex': 5},
}

# ë§¤í•‘ ì ìš©
for col, mapping in ordinal_mappings.items():
    df[col] = df[col].map(mapping)

df = pd.get_dummies(df, columns=['RoofStyle', 'Exterior1st', 'Foundation', 'PavedDrive'], drop_first=True)


# 6ï¸. ê²°ì¸¡ì¹˜ í™•ì¸
print(df.isnull().sum())


# LassoCV (ë³€ìˆ˜ 39ê°œ)
import pandas as pd
from sklearn.linear_model import LassoCV
from sklearn.preprocessing import StandardScaler

# ë…ë¦½ë³€ìˆ˜(X), ì¢…ì†ë³€ìˆ˜(y) ë¶„ë¦¬
X = df.drop(columns=['SalePrice'])
y = df['SalePrice']

# 1. ìŠ¤ì¼€ì¼ë§ (í‘œì¤€í™”)
scaler = StandardScaler()
X_scaled = scaler.fit_transform(X)  # Xë¥¼ í‰ê·  0, í‘œì¤€í¸ì°¨ 1ë¡œ ë³€í™˜

# 2ï¸. LassoCV í•™ìŠµ (êµì°¨ê²€ì¦ìœ¼ë¡œ alpha ì°¾ê¸°)
lasso = LassoCV(cv=5, random_state=2025)
lasso.fit(X_scaled, y)

# 3. ê²°ê³¼ í™•ì¸
best_alpha = lasso.alpha_
coefficients = lasso.coef_

# 4. ê³„ìˆ˜ì™€ ë³€ìˆ˜ëª…ì„ ë°ì´í„°í”„ë ˆì„ìœ¼ë¡œ ì •ë¦¬
coef_df = pd.DataFrame({
    'Feature': X.columns,
    'Coefficient': coefficients
}).sort_values(by='Coefficient', key=abs, ascending=False)

print(f"Best alpha: {best_alpha}")
print(coef_df)



# Lasso alpha
from sklearn.linear_model import Lasso
from sklearn.metrics import mean_squared_error
import matplotlib.pyplot as plt

# ê¸°ì¤€ alpha (LassoCVì—ì„œ ë‚˜ì˜¨ ê°’)
base_alpha = lasso.alpha_

# ì‹¤í—˜í•  alpha ë°°ìˆ˜ë“¤
alpha_multipliers = [0.5, 1, 2, 5, 10, 15, 20, 25]
results = []

# ë°˜ë³µí•´ì„œ ëª¨ë¸ ëŒë¦¬ê¸°
for m in alpha_multipliers:
    alpha = base_alpha * m
    model = Lasso(alpha=alpha, max_iter=10000)
    model.fit(X_scaled, y)
    coef = model.coef_
    num_nonzero = np.sum(coef != 0)
    y_pred = model.predict(X_scaled)
    mse = mean_squared_error(y, y_pred)

    results.append({
        'alpha': round(alpha, 5),
        'multiplier': m,
        'num_features': num_nonzero,
        'mse': round(mse, 2)
    })

    # ë‚¨ì•„ ìˆëŠ” ë³€ìˆ˜ ì¶œë ¥
    print(f"\n[alpha = {alpha:.5f}]")
    print(f"ë‚¨ì€ ë³€ìˆ˜ ê°œìˆ˜: {num_nonzero}")
    print("ì„ íƒëœ ë³€ìˆ˜:")
    print(pd.Series(X.columns[coef != 0]).values)

# ê²°ê³¼ DataFrameìœ¼ë¡œ ì •ë¦¬
results_df = pd.DataFrame(results)
print("\nğŸ“Š Alphaë³„ ê²°ê³¼:")
print(results_df)
```

```{python}
import matplotlib.pyplot as plt

# ê·¸ë˜í”„ë¡œ ë³´ê¸°
plt.figure(figsize=(10, 5))
plt.plot(results_df['alpha'], results_df['num_features'], marker='o', label='Selected Features')
plt.xlabel('Alpha')
plt.ylabel('Number of Selected Features')
plt.title('Alpha ê°’ì— ë”°ë¥¸ ë³€ìˆ˜ ì„ íƒ ê°œìˆ˜ ë³€í™”')
plt.grid(True)
plt.legend()
plt.show()
```

#### ìµœì¢… ë³€ìˆ˜


| ëª¨ë¸     | Adj. R-squared | AIC     |
|----------|----------------|---------|
| Model 1  | 0.852          | 58050   |
| Model 2  | 0.853          | 58030   |

- ìµœì¢… ë³€ìˆ˜
    'GrLivArea', 'TotalBsmtSF', 'GarageArea', 
    'OverallQual', 'KitchenQual', 'BsmtQual', 'ExterQual', 
    'OverallCond', 'BsmtFullBath',
    'YearBuilt' 


```{python}
#| echo: false
#| include: false

from sklearn.linear_model import LassoCV
lasso = LassoCV(cv=5).fit(X_scaled, y)
top_features = coef_df[coef_df["Coefficient"] != 0]['Feature'].head(10).tolist()
```

```{python}
#| echo: false
#| include: false
from sklearn.model_selection import GridSearchCV, KFold

# alphaë¡œ ì°¾ê¸°
selected_features = ['OverallQual', 'ExterQual', 'KitchenQual' ,'YearBuilt', 'BsmtFullBath',
'GrLivArea', 'TotalBsmtSF' ,'GarageArea' ,'WoodDeckSF','RoofStyle_Hip' ]

# ì ˆëŒ€ê°’ìœ¼ë¡œ 10ê°œ ì°¾ê¸°
# 1. ì¢…ì†ë³€ìˆ˜ ë¡œê·¸ ë³€í™˜
y = (df['SalePrice'])  # log(1 + y)

# 2. ìƒìœ„ 10ê°œ í”¼ì²˜ ì„ íƒ (ê¸°ì¡´ coef_df ê¸°ì¤€)
top_features = coef_df[coef_df["Coefficient"] != 0]['Feature'].head(10).tolist()
X = df[top_features]

# 3. ìŠ¤ì¼€ì¼ë§
scaler = StandardScaler()
X_scaled = scaler.fit_transform(X)

# 4. Lasso + GridSearchCV ì„¤ì •
lasso = Lasso(max_iter=10000)
alphas = np.linspace(0.01, 1, 100)
cv = KFold(n_splits=5, shuffle=True, random_state=2025)
grid = GridSearchCV(estimator=lasso, param_grid={'alpha': alphas},
                    cv=cv, scoring='neg_mean_squared_error')
grid.fit(X_scaled, y)
```

```{python}
# 5. ìµœì  alpha ë° ì„±ëŠ¥ í™•ì¸
print("Best alpha:", grid.best_params_['alpha'])
print("Best CV Score (MSE):", -grid.best_score_)

# 6. íšŒê·€ ê³„ìˆ˜ ì¶œë ¥
coef_df_top = pd.DataFrame({
    'Feature': top_features,
    'Coefficient': grid.best_estimator_.coef_}).sort_values(by='Coefficient', key=abs, ascending=False)

print(coef_df_top)
```



# ìœ ì§€ë³´ìˆ˜ ì ìˆ˜í™” ê³¼ì •

### 
ğŸ“Œ **ì ìˆ˜í™” ê³¼ì •**

âœ”ï¸ 10ê°œ ì„ ì •ëœ ë³€ìˆ˜ë“¤ ì‚¬ì´ì—ì„œ ì´ìƒì¹˜ ì²´í¬<br>
âœ”ï¸ MinMaxScaler ì ìš©í•˜ê¸°<br>
âœ”ï¸ ë©´ì , í’ˆì§ˆ, ìƒíƒœ, ì—°ì‹ scoreë¡œ ë§Œë“¤ê¸°<br>
âœ”ï¸ score ë³„ ê°€ì¤‘ì¹˜ ê³±í•˜ê³  í•©ì‚° ì§„í–‰<br>
âœ”ï¸ ê°€ì¤‘ì¹˜ ì»¬ëŸ¼(MaintenanceScore)ì„ ë§Œë“¤ê¸°<br>



### ìœ ì§€ë³´ìˆ˜ ì ìˆ˜í™” ê³„ì‚° ë‹¨ê³„ {.tabset}


#### ğŸ“Œ Step 1

- ì„ ì •í•œ 10ê°œ ë³€ìˆ˜ë“¤ ì‚¬ì´ ì´ìƒì¹˜ë¥¼ í™•ì¸<br>
- **GrLivArea**, **GarageArea**, **TotalBsmtSF**ì—ì„œ ì´ìƒì¹˜ ì œê±°<br>

```{python}
#| echo: False
#| include: true
import matplotlib.pyplot as plt
import seaborn as sns

# ì´ìƒì¹˜ ì‹œê°í™”
fig = plt.figure(figsize=(16, 12))
for i, col in enumerate(top_features):
    ax = fig.add_subplot(4, 3, i + 1)
    sns.scatterplot(data=df, x=col, y='SalePrice', s=20, ax=ax)
    _ = ax.set_xlabel(col)
    _ = ax.set_ylabel('')

plt.tight_layout()
plt.show()

# ì´ìƒì¹˜ ì¡°ê±´
condition = (
    (df['GrLivArea'] <= 3500) &
    (df['GarageArea'] <= 1200) &
    (df['TotalBsmtSF'] <= 2500)
)

# ì´ìƒì¹˜ ì œê±°
df_clean = df[condition].copy()

```

#### ğŸ“Œ Step 2

- **MinMaxScaler**ë¥¼ ì ìš©í•˜ê¸° <br>
    - ë‹¨ìœ„ê°€ ì œê°ê°ì¼ ê²½ìš° ì—°ì‚°ì´ë‚˜ ê±°ë¦¬ ê¸°ë°˜ ê³„ì‚°ì„ í• ë•Œ ì˜í–¥ì„ í¬ê²Œ ë°›ëŠ” ë³€ìˆ˜ê°€ ì™œê³¡ ë  ìˆ˜ ìˆìŒ.<br>
    - ì„œë¡œ ë‹¤ë¥¸ ë‹¨ìœ„ë¥¼ ê°–ëŠ” ë³€ìˆ˜ë“¤ì„ ë™ì¼í•œ ë²”ìœ„(0~1)ë¡œ ìŠ¤ì¼€ì¼ë§í•˜ì—¬ ë¹„êµ ê°€ëŠ¥í•˜ê²Œ ë§Œë“¤ê¸° ìœ„í•´ì„œ! <br>
    - ìµœì†Œê°’ì€ 0, ìµœëŒ€ê°’ì€ 1ë¡œ ë§ì¶°ì£¼ëŠ” ë°©ì‹


#### ğŸ“Œ Step 3

- ê° ë³€ìˆ˜ë“¤ì„ **ë©´ì , í’ˆì§ˆ, ìƒíƒœ, ì—°ì‹**ìœ¼ë¡œ êµ¬ì„±
    - area_score(ë©´ì ) : 'GrLivArea', 'TotalBsmtSF', 'GarageArea'<br>
    - quality_score(í’ˆì§ˆ) : 'OverallQual', 'KitchenQual', 'BsmtQual', 'ExterQual'<br>
    - condition_score(ìƒíƒœ) : 'OverallCond', 'BsmtFullBath'<br>
    - year_score(ì—°ì‹) : 'YearBuilt'<br>
<br>
<br>
- ê° scoreë¥¼ ì•„ë˜ì™€ ê°™ì´ ê³„ì‚°<br>
    - area_score = df_clean['GrLivArea'] + df_clean['TotalBsmtSF'] + df_clean['GarageArea']<br>
    - quality_score = (1 - df_clean['OverallQual']) + (1 - df_clean['KitchenQual']) + (1 - df_clean['BsmtQual']) + (1 - df_clean['ExterQual'])<br>
    - condition_score = (1 - df_clean['OverallCond']) + (1 - df_clean['BsmtFullBath'])<br>
    - year_score = 1 - df_clean['YearBuilt']<br>

#### ğŸ“Œ Step 4
- **quality_score** ì™€ **year_score**ì— ì¡°ê¸ˆ ë” ë¹„ì¤‘ì„ ë‘¬ì„œ ê°€ì¤‘ì¹˜ ì§„í–‰<br>
<br>
<br>

- ê°€ì¤‘ì¹˜ë¥¼ ë‘¬ì„œ ê³„ì‚° ì§„í–‰
    - df['MaintenanceScore'] = area_score * 0.2 + quality_score * 0.3 + condition_score * 0.2 + year_score * 0.3
<br>
<br>

- **MaintenanceScore**ì„ A(ìµœìš°ìˆ˜),B(ì–‘í˜¸),C(ê°œì„ í•„ìš”),D(ì‹œê¸‰)ìœ¼ë¡œ êµ¬ë¶„

```{python}
#| echo: True
#| include: false



import pandas as pd
from sklearn.preprocessing import MinMaxScaler


# ìŠ¤ì¼€ì¼ë§í•  ë³€ìˆ˜ ëª©ë¡
scale_columns = [
    'GrLivArea', 'TotalBsmtSF', 'GarageArea',   # ë©´ì 
    'OverallQual', 'KitchenQual', 'BsmtQual', 'ExterQual',  # í’ˆì§ˆ
    'OverallCond', 'BsmtFullBath',  # ìƒíƒœ
    'YearBuilt'  # ì—°ì‹
]

# MinMaxScaler ì ìš© (0~1 ë²”ìœ„)
scaler = MinMaxScaler()
df_clean[scale_columns] = scaler.fit_transform(df_clean[scale_columns])
df_clean = df_clean[scale_columns]


# ë©´ì  ê·¸ëŒ€ë¡œ
area_score = df_clean['GrLivArea'] + df_clean['TotalBsmtSF'] + df_clean['GarageArea']

# í’ˆì§ˆ/ìƒíƒœ/ì—°ì‹ ë’¤ì§‘ê¸° (1 - ê°’)
quality_score = (1 - df_clean['OverallQual']) + (1 - df_clean['KitchenQual']) + (1 - df_clean['BsmtQual']) + (1 - df_clean['ExterQual'])
condition_score = (1 - df_clean['OverallCond']) + (1 - df_clean['BsmtFullBath'])
year_score = 1 - df_clean['YearBuilt']  # ì—°ì‹ë„ ë°˜ì „

# ê°€ì¤‘ì¹˜ ê³±í•˜ê³  í•©ì‚°
df['MaintenanceScore'] = (
    area_score * 0.2 +
    quality_score * 0.3 +
    condition_score * 0.2 +
    year_score * 0.3
)
```


#### ğŸ“Œ Step 5

- **MaintenanceScore** ë†’ë‹¤ëŠ” ê²ƒì€ ê°€ê²©ëŒ€ë¹„ ìœ ì§€ë³´ìˆ˜ê°€ ë†’ë‹¤ëŠ” ê²ƒ
<br> => í•´ë‹¹ ì§‘ì€ í”¼í•´ì•¼í•˜ëŠ” ì§‘!
<br>

- **MaintenanceScore** ì˜ í‰ê· ê³¼ í‘œì¤€í¸ì°¨ë¥¼ í™œìš©í•˜ì—¬ ë“±ê¸‰ì„ ë‚˜ëˆ„ê¸°<br>
    - **MaintenanceScore** >= mean + std ==> D (ì‹œê¸‰)
    - **MaintenanceScore** >= mean       ==> C (ê°œì„ í•„ìš”)
    - **MaintenanceScore** >= mean - std ==> B (ì–‘í˜¸)
    - **MaintenanceScore** ê·¸ ì™¸         ==> A (ìµœìš°ìˆ˜)

- ì™œ? í‰ê· ê³¼ í‘œì¤€í¸ì°¨ë¥¼ í™œìš©í•˜ëŠ” ê±¸ê¹Œ?
    - ë¶„í¬ì˜ ì¤‘ì‹¬ê°’(í‰ê· )ì„ ê¸°ì¤€ìœ¼ë¡œ íŒë‹¨í•˜ë‹ˆ, ì „ì²´ ë°ì´í„° ë¹„êµì— ìœ ë¦¬
    - ì ˆëŒ€ê°’ ê¸°ì¤€ë³´ë‹¤ ëœ ì™œê³¡ë¨

```{python}
#| echo: True
#| include: false

selected_features = ['OverallQual', 'ExterQual', 'KitchenQual' ,'YearBuilt', 'BsmtFullBath',
'GrLivArea', 'TotalBsmtSF' ,'GarageArea' ,'WoodDeckSF','RoofStyle_Hip' ]

df_copy = df[condition].copy()



mean = df['MaintenanceScore'].mean()
std = df['MaintenanceScore'].std()


# ì´ê±´ ì •ê·œë¶„í¬ ë˜ëŠ” ë¹„ìŠ·í•œ ë¶„í¬ë¥¼ ê°€ì§„ ì ìˆ˜ê°’ë“¤ì„
# ìƒëŒ€ì ìœ¼ë¡œ ë‚˜ëˆ„ê¸° ìœ„í•œ ì¼ë°˜ì ì¸ ì „ëµ
# ì ìˆ˜ê°€ ëª‡ ì ì´ ë†’ê³  ë‚®ì€ì§€ ëª…í™•íˆ ê¸°ì¤€ì„ ì œì‹œí•  ìˆ˜ ìˆì–´.
# ë¶„í¬ì˜ ì¤‘ì‹¬ê°’(í‰ê· )ì„ ê¸°ì¤€ìœ¼ë¡œ íŒë‹¨í•˜ë‹ˆ, ì „ì²´ ë°ì´í„° ë¹„êµì— ìœ ë¦¬.
# ì ˆëŒ€ê°’ ê¸°ì¤€ë³´ë‹¤ ëœ ì™œê³¡ë¨, íŠ¹íˆ ìŠ¤ì¼€ì¼ë§ëœ ë°ì´í„°ì—ì„œëŠ” ë”ìš±!


def hybrid_grade(score):
    if score >= mean + std:
        return "D (ì‹œê¸‰)"
    elif score >= mean:
        return "C (ê°œì„  í•„ìš”)"
    elif score >= mean - std:
        return "B (ì–‘í˜¸)"
    else:
        return "A (ìµœìš°ìˆ˜)"

df_copy['MaintenanceGrade'] = df['MaintenanceScore'].apply(hybrid_grade)

```





<div style="all: unset; font-family: sans-serif; font-size: 16px; color: black; line-height: 1.6;">
::: {.no-style}



# ê²°ë¡  





::: {.card title="**ë“±ê¸‰ êµ¬ê°„ ë³„ ë¶„í¬**"}




```{python}

grade_order = ['A (ìµœìš°ìˆ˜)', 'B (ì–‘í˜¸)', 'C (ê°œì„  í•„ìš”)', 'D (ì‹œê¸‰)']
df_copy['MaintenanceGrade'] = pd.Categorical(df_copy['MaintenanceGrade'],
                                            categories=grade_order,
                                            ordered=True)
                                            
plt.figure(figsize=(8, 6))
sns.scatterplot(data=df_copy, x='MaintenanceScore', y='SalePrice', hue='MaintenanceGrade')
_ = plt.title("SalePrice vs MaintenanceScore")
_ = plt.xlabel("Maintenance Score")
_ = plt.ylabel("Sale Price")
plt.grid(True)
plt.show()

```

:::


::: {.card title="**Aë“±ê¸‰ ì¤‘ ê°€ê²©ì´ ë‚®ì€ ìƒìœ„ 10ê°œ ì§‘**"}


```{python}

# 1. Dë“±ê¸‰ë§Œ í•„í„°ë§ + ì •ë ¬ (ë¡œì»¬ì—ì„œ ë‹¤ì‹œ ì •ì˜)
df_copy_d = df_copy[df_copy['MaintenanceGrade'] == 'A (ìµœìš°ìˆ˜)'].copy()
df_d_sorted = df_copy_d.sort_values(by='SalePrice', ascending=True)

# 2. ìƒìœ„ 10ê°œ ì„ íƒ
top10_d = df_d_sorted.head(10)
import plotly.express as px

top10_d[selected_features]
top10_d = top10_d.reset_index()

# 3. ì§€ë„ ì‹œê°í™”
fig = px.scatter_mapbox(
    top10_d,
    lat="Latitude",
    lon="Longitude",
    color="SalePrice",
    size="SalePrice",
    color_continuous_scale="Reds",
    size_max=15,
    zoom=11,
    mapbox_style="carto-positron",
    hover_data=["SalePrice", "MaintenanceGrade", "YearBuilt", "GrLivArea","index"]
)

fig.update_layout(
    title="Top 10 A-Grade Houses (Low Price & Low Maintenance Score)",
    width=950,

    margin={"r":30,"t":30,"l":0,"b":0}
)



```

:::


::: {.card title="**ë“±ê¸‰ ë³„ ë¶„í¬ ì§€ë„ ì‹œê°í™”**"}


```{python}

fig = px.scatter_mapbox(
    df_copy,
    lat="Latitude",
    lon="Longitude",
    color="MaintenanceGrade",  # ë“±ê¸‰ë³„ ìƒ‰ìƒ êµ¬ë¶„
    category_orders={
        "MaintenanceGrade": ["A (ìµœìš°ìˆ˜)", "B (ì–‘í˜¸)", "C (ê°œì„  í•„ìš”)", "D (ì‹œê¸‰)"]
    },
    mapbox_style="carto-positron",
    zoom=11,
    size="SalePrice",  # í˜¹ì€ GrLivAreaë„ ê°€ëŠ¥
    size_max=12,
    hover_data=["SalePrice", "MaintenanceGrade", "YearBuilt", "GrLivArea"]
)

fig.update_layout(
    title="Maintenance Grade of All Properties in Ames Housing",
    width=950,
    margin={"r":30,"t":30,"l":0,"b":0}

)



```


:::

::: {.card title="**ì§€ì—­ë³„ í‰ê·  MaintenanceScore**"}






```{python}
import seaborn as sns


origin_data = pd.read_csv("./plotly_data/ames.csv")
df_neigh = origin_data[[ 'Neighborhood']]  # ë˜ëŠ” 'Id'ê°€ ê¸°ì¤€ì´ë¼ë©´ ê·¸ê±¸ë¡œ
df_copy = df_copy.merge(origin_data[['Neighborhood']], left_index=True, right_index=True)



pivot = df_copy.pivot_table(index="Neighborhood", values="MaintenanceScore", aggfunc="mean")
plt.figure(figsize=(8, 10))
sns.heatmap(pivot.sort_values("MaintenanceScore", ascending=False), cmap="RdYlGn_r", annot=True)
plt.title("Neighborhood-wise Average Maintenance Score")
plt.show()

```

:::

::: {.card title="**ì§€ì—­ ë³„ ê°€ì¥ ë§ì´ ë¶„í¬ëœ ìœ ì§€ë³´ìˆ˜ ë“±ê¸‰ **"}




```{python}

###########################################
# Neighborhoodë³„ ì§€ë„ ì‹œê°í™”





# 1. ë“±ê¸‰ ë¹„ìœ¨ ê³„ì‚°
grade_pct = pd.crosstab(df_copy['Neighborhood'], df_copy['MaintenanceGrade'])
grade_pct = grade_pct.div(grade_pct.sum(axis=1), axis=0) * 100

# 2. ê°€ì¥ ë§ì€ ë“±ê¸‰ ì„ íƒ
grade_pct['DominantGrade'] = grade_pct.idxmax(axis=1)

# 3. ì¢Œí‘œ í‰ê· 
coords = df_copy.groupby('Neighborhood')[['Latitude', 'Longitude']].mean()

# 4. ë³‘í•©
import plotly.express as px
house_counts = df_copy['Neighborhood'].value_counts().rename("NumHouses")
# 5. ë³‘í•© í›„ í‘œë³¸ ìˆ˜ê¹Œì§€ ì¶”ê°€
neigh_dominant = grade_pct[['DominantGrade']].merge(coords, left_index=True, right_index=True)
neigh_dominant = neigh_dominant.merge(house_counts, left_on='Neighborhood', right_index=True).reset_index()

fig = px.scatter_mapbox(
    neigh_dominant,
    lat="Latitude",
    lon="Longitude",
    size="NumHouses", 
    color="DominantGrade", 
    color_discrete_sequence=px.colors.qualitative.Set2,
    category_orders={
    "DominantGrade": ["A (ìµœìš°ìˆ˜)", "B (ì–‘í˜¸)", "C (ê°œì„  í•„ìš”)", "D (ì‹œê¸‰)"]
    },
    mapbox_style="carto-positron",
    zoom=11,
    size_max=30,
    hover_name="Neighborhood",
    hover_data={"DominantGrade": True, "Latitude": False, "Longitude": False}
)

fig.update_layout(
    title=" Dominant Grade by Neighborhood",
    width=950,
    margin={"r":30,"t":30,"l":0,"b":0}
)


```

::: 





```{python}
#| echo: false
#| include: false
####  ê²Œì´ì§€ ì°¨íŠ¸ ì‹œê°í™” : ì¤‘ê°„ ìˆ«ìëŠ” í‰ê·  ê°€ê²©

# í‰ê·  ê³„ì‚°
species_avg = df_copy.groupby("MaintenanceGrade")["SalePrice"].mean().reindex(
    ["A (ìµœìš°ìˆ˜)", "B (ì–‘í˜¸)", "C (ê°œì„  í•„ìš”)", "D (ì‹œê¸‰)"]
)

# ìµœëŒ€ê°’ ì„¤ì •
max_val = df_copy["SalePrice"].max()
import plotly.graph_objects as go
# ê·¸ë˜í”„ ìƒì„±
fig = go.Figure()

for i, (grade, avg_price) in enumerate(species_avg.items()):
    fig.add_trace(go.Indicator(
        mode="gauge+number",
        value=round(avg_price / 1000),  # ì²œ ë‹¨ìœ„ kë¡œ í‘œì‹œ
        number={"suffix": "k", "font": {"size": 40}},
        title={'text': f"<b>{grade}</b>", "font": {"size": 18}},
        domain={'row': i // 2, 'column': i % 2},  # 2í–‰ 2ì—´
        gauge={
            'axis': {'range': [0, round(max_val / 1000)], 'tickformat': 'k'},
            'bar': {'color': 'darkblue'},
            'steps': [
                {'range': [0, round(max_val * 0.5 / 1000)], 'color': '#d0f0f5'},
                {'range': [round(max_val * 0.5 / 1000), round(max_val / 1000)], 'color': '#9dddf2'}
            ],
        }
    ))

# ë ˆì´ì•„ì›ƒ ì ìš©
fig.update_layout(
    grid={'rows': 2, 'columns': 2, 'pattern': "independent"},
    title="<b>MaintenanceGrade vs. Average SalePrice</b>",
    width=1000,
    font=dict(family="Arial", size=14)
)


```


::: {.card title="**ë“±ê¸‰ ë³„ í‰ê·  SalePrice **"}

```{python}
fig.show()
```

:::

:::

</div>


